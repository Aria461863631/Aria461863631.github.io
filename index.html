<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favico.jpg?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favico.jpg?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="This guy is so lazy that he left nothing">
<meta property="og:type" content="website">
<meta property="og:title" content="Aria">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Aria">
<meta property="og:description" content="This guy is so lazy that he left nothing">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Aria">
<meta name="twitter:description" content="This guy is so lazy that he left nothing">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Aria</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Aria</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">あなたには僕が見えるが?</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/27/SICP/sicp4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/27/SICP/sicp4/" itemprop="url">[SICP-ch4] Metalinguistic Abstraction</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-27T16:36:51+08:00">
                2018-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SICP/" itemprop="url" rel="index">
                    <span itemprop="name">SICP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/27/SICP/sicp4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/27/SICP/sicp4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>[SICP-ch4] Metalinguistic Abstraction</h2>
<p>establishing new languages and implement these languages by constructing evaluators.</p>
<p>(极简版)</p>
<p>&lt;br/&gt;</p>
<p>evaluators ( interpreter )</p>
<ul>
<li>a procedure that, when applied to an expression of the language, performs the actions required to evaluate that expression.</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>4.1 The Metacircular Evaluator</h3>
<p>metacircular</p>
<ul>
<li>An evaluator that is written in the same language that it evaluates</li>
</ul>
<p>&lt;!-- more --&gt;</p>
<p>Recall environment model</p>
<ul>
<li>To <strong>evaluate</strong> a compound procedure, evaluate the subexpressions and then <strong>apply</strong> the
value</li>
<li>To <strong>apply</strong> a compound procedure, <strong>evaluate</strong> the body of the procedure in a new environment.</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524817444/Screenshot_from_2018-04-27_16-21-11.png" alt=""></p>
<p><strong>Data Abstraction</strong></p>
<ul>
<li>make the evaluator independent of the representation of the language.</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.1.1 The Core of the Evaluator</strong></p>
<p><code>eval</code> and <code>apply</code></p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">eval</span> exp env)</span>
<span class="line">    	<span class="comment">;primitive</span></span>
<span class="line">   (<span class="name">cond</span> ((<span class="name">self-evaluating</span>? exp) exp)</span>
<span class="line">		((<span class="name">variable</span>? exp) (<span class="name">lookup-variable-value</span> exp env))</span>
<span class="line">       	<span class="comment">;special form</span></span>
<span class="line">		((<span class="name">quoted</span>? exp) (<span class="name">text-of-quotation</span> exp))</span>
<span class="line">		((<span class="name">assignment</span>? exp) (<span class="name">eval-assignment</span> exp env))</span>
<span class="line">		((<span class="name">definition</span>? exp) (<span class="name">eval-definition</span> exp env))</span>
<span class="line">		((<span class="name">if</span>? exp) (<span class="name">eval-if</span> exp env))</span>
<span class="line">		((<span class="name">lambda</span>? exp) (<span class="name">make-procedure</span> (<span class="name">lambda-parameters</span> exp)</span>
<span class="line">									(<span class="name">lambda-body</span> exp)</span>
<span class="line">									env))</span>
<span class="line">		((<span class="name">begin</span>? exp)</span>
<span class="line">		     (<span class="name">eval-sequence</span> (<span class="name">begin-actions</span> exp) env))</span>
<span class="line">		((<span class="name">cond</span>? exp) (<span class="name">eval</span> (<span class="name">cond-&gt;if</span> exp) env))</span>
<span class="line">       		<span class="comment">;combinations</span></span>
<span class="line">		((<span class="name">application</span>? exp)</span>
<span class="line">         	<span class="comment">;apply</span></span>
<span class="line">			(<span class="name">apply</span> (<span class="name">eval</span> (<span class="name">operator</span> exp) env)</span>
<span class="line">				   (<span class="name">list-of-values</span> (<span class="name">operands</span> exp) env)))</span>
<span class="line">		(<span class="name">else</span></span>
<span class="line">		      (<span class="name">error</span> <span class="string">"Unknown expression type: EVAL"</span> exp))))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">apply</span> procedure arguments)</span>
<span class="line">    		<span class="comment">;primitive</span></span>
<span class="line">	(<span class="name">cond</span> ((<span class="name">primitive-procedure</span>? procedure)</span>
<span class="line">		   (<span class="name">apply-primitive-procedure</span> procedure arguments))</span>
<span class="line">        	<span class="comment">;compound</span></span>
<span class="line">		  ((<span class="name">compound-procedure</span>? procedure)</span>
<span class="line">           <span class="comment">;eval</span></span>
<span class="line">		   (<span class="name">eval-sequence</span></span>
<span class="line">				(<span class="name">procedure-body</span> procedure)</span>
<span class="line">				(<span class="name">extend-environment</span></span>
<span class="line">					(<span class="name">procedure-parameters</span> procedure)</span>
<span class="line">					arguments</span>
<span class="line">					(<span class="name">procedure-environment</span> procedure))))</span>
<span class="line">		(<span class="name">else</span></span>
<span class="line">			(<span class="name">error</span></span>
<span class="line">				<span class="string">"Unknown procedure type: APPLY"</span> procedure))))</span>
</pre></td></tr></table></figure></p>
<p>Conditionals <code>eval-if</code></p>
<p>Sequences <code>eval-sequence</code></p>
<p>Assignments <code>eval-assignment</code></p>
<p>Definitions <code>eval-definition</code></p>
<p>&lt;br/&gt;</p>
<p><strong>4.1.2 Representing Expressions</strong></p>
<p>building constructor, selector and predeicate of our language</p>
<p>&lt;br/&gt;</p>
<ul>
<li>The only self-evaluating items are numbers and strings</li>
<li>Variables are represented by symbols</li>
<li>Quotations have the form <code>(quote ⟨text-of-quotation⟩)</code></li>
<li>Assignments have the form <code>(set! ⟨var⟩ ⟨value⟩)</code></li>
<li>Definitions have the form <code>(define ⟨var⟩ ⟨value⟩)</code></li>
<li>lambda expressions are <em>lists that begin with the symbol lambda</em></li>
<li>Conditionals <em>begin with if and have a predicate, a consequent, and an (optional) alternative.</em></li>
<li>begin packages <em>a sequence of expressions</em> into a single expression.</li>
<li>An application is any compound expression with <em>operator in car and operands in cdr</em></li>
</ul>
<p>Derived expressions</p>
<ul>
<li>cond</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.1.3 Evaluator Data Structures</strong></p>
<p>representation of</p>
<ul>
<li>true and false</li>
</ul>
<ul>
<li>procedures</li>
<li>environments  （a sequence of frams and each frame is a table of bindings）</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.1.4 Running the Evaluator as a Program</strong></p>
<ul>
<li>model the application of primitive procedures.</li>
<li>set up a global environment</li>
<li>provide a <strong>driver loop that models the read-eval-print loop</strong></li>
</ul>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">driver-loop</span>)</span>
<span class="line">	(<span class="name">prompt-for-input</span> input-prompt)</span>
<span class="line">    <span class="comment">;input</span></span>
<span class="line">	(<span class="name">let</span> ((<span class="name">input</span> (<span class="name">read</span>)))</span>
<span class="line">         <span class="comment">;evaluate output</span></span>
<span class="line">		(<span class="name">let</span> ((<span class="name">output</span> (<span class="name">eval</span> input the-global-environment)))</span>
<span class="line">			(<span class="name">announce-output</span> output-prompt)</span>
<span class="line">			(<span class="name">user-print</span> output)))</span>
<span class="line">(<span class="name">driver-loop</span>))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>4.1.5 Data as Programs</strong></p>
<p>One operational view of the meaning of a program is that a program is a description of an abstract (perhaps infinitely large) <strong>machine</strong>.</p>
<p>&lt;br/&gt;</p>
<p>Evaluator as a bridge between the <strong>data objects</strong> and the language</p>
<ul>
<li>From the perspective of the user, (* x x) is an expression in the programming language</li>
<li>From the perspective of the evaluator,  (* x x) is simply a list to be manipulated.</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.1.6 Internal Definitions</strong></p>
<p>evaluator execute definitions in sequence, resulting <strong>different scope</strong> for internal definition</p>
<p>Ways providing simultaneous scope</p>
<ul>
<li>scan all definitions and create, and then set to their values by assignment.</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.1.7 Separating Syntactic Analysis from Execution</strong></p>
<p>separate <code>eval</code> into <strong>analysis</strong> and <strong>execution</strong></p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">eval</span> exp env) ((<span class="name">analyze</span> exp) env))</span>
</pre></td></tr></table></figure></p>
<p>syntactic of analysis procedure</p>
<ul>
<li>returns an <strong>execution procedure</strong> that ignores its environment argument</li>
</ul>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">analyze-self-evaluating</span> exp)</span>
<span class="line">	(<span class="name">lambda</span> (<span class="name">env</span>) exp))</span>
</pre></td></tr></table></figure></p>
<p><code>analyze-quoted</code>, <code>analyze-variable</code>, <code>analyze-assignment</code>, <code>analyze-definition</code>, <code>analyze-if</code></p>
<p><code>analyze-lambda</code>, <code>analyze-sequence</code>, <code>analyze-application</code></p>
<p>&lt;br/&gt;</p>
<h3>4.2 Variations on a Scheme — Lazy Evaluation</h3>
<p><strong>4.2.1 Normal Order and Applicative Order</strong></p>
<p>applicative-order</p>
<ul>
<li>evaluate arguments than apply</li>
<li>strict procedure</li>
</ul>
<p>normal-order</p>
<ul>
<li>enter body procedure than evaluate arguments</li>
<li>non-strict procedure</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.2.2 An Interpreter with Lazy Evaluation</strong></p>
<p>implement a normal-order language</p>
<p>&lt;br/&gt;</p>
<p>thunk</p>
<ul>
<li>delayed arguments</li>
<li>contain the information for applying when needed</li>
<li>forcing : evaluating expression in thunk</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Modifying the evaluator</p>
<p>primitive: strict</p>
<p>compound: non-strict</p>
<p>change <code>eval</code> into <code>actual-value</code></p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">actual-value</span> exp env)</span>
<span class="line">	(<span class="name">force-it</span> (<span class="name">eval</span> exp env)))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Representing thunks</p>
<p>&lt;br/&gt;</p>
<p><strong>4.2.3 Streams as Lazy Lists</strong></p>
<p>With lazy evaluation, streams and <strong>lists</strong> can be identical, so there is no need for special forms or for separate list and stream operations.</p>
<p>Represent <code>car</code>,  <code>cdr</code> and <code>cons</code> as non-strict procedure</p>
<p>List lazier than previous stream</p>
<ul>
<li>The <code>car</code> of the list, as well as the <code>cdr</code> , is delayed.</li>
<li>won't need explicit <code>delay</code> anymore ( ch-3 )</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>4.3 Variations on a Scheme — Nondeterministic Computing</h3>
<p>nondeterministic computing</p>
<ul>
<li>support automatic search</li>
<li>expressions have more than one possible value</li>
</ul>
<p>Our approach</p>
<ul>
<li>generate the sequence of all possible pairs and filter</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.3.1 Amb and Search</strong></p>
<p>amb</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">list</span> (<span class="name">amb</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>) (<span class="name">amb</span> 'a 'b))</span>
<span class="line"></span>
<span class="line">can have six possible values:</span>
<span class="line"></span>
<span class="line">(<span class="number">1</span> a) (<span class="number">1</span> b) (<span class="number">2</span> a) (<span class="number">2</span> b) (<span class="number">3</span> a) (<span class="number">3</span> b)</span>
</pre></td></tr></table></figure></p>
<p>require</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">require</span> p) (<span class="name">if</span> (<span class="name">not</span> p) (<span class="name">amb</span>)))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>evaluate amb causes time to split into branches</p>
<ul>
<li>machine with sufficient number of processors: parallel executions of choices</li>
<li>machine with only one processor: dfs</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.3.2 Examples of Nondeterministic Programs</strong></p>
<p>Logical puzzles</p>
<p>Parsing natural language</p>
<p>&lt;br/&gt;</p>
<p><strong>4.3.3 Implementing the amb Evaluator</strong></p>
<p>Nondeterministic evaluation</p>
<ul>
<li>result in the discovery of a dead end, must <strong>backtrack</strong> to a previous choice point</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Base on 4.1.7: analyzing evalutor ( analyze + execute )</p>
<p>Difference</p>
<ul>
<li>entirely in the <strong>execution</strong> procedures</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Execution procedures and continuations</strong></p>
<p>the execution procedures in the amb evaluator take three arguments</p>
<ul>
<li>Original: environment</li>
<li>Additional: success continuation &amp; failure continuation</li>
</ul>
<p>&lt;br/&gt;</p>
<p>success continuation</p>
<ul>
<li>Arguments: value &amp; failure continuation</li>
<li>recieve value and proceed with the computation</li>
<li>call faliure continuation when value leads to a dead end</li>
</ul>
<p>&lt;br/&gt;</p>
<p>failure continuation</p>
<ul>
<li>try another branch of the nondeterministic process</li>
</ul>
<p>In summary, failure continuations are <strong>constructed</strong> by</p>
<ul>
<li><code>amb</code> expressions—to provide a mechanism to <strong>make alternative choices</strong> if the current choice leads to a dead end;</li>
<li><code>the top-level driver</code>—to provide a mechanism to <strong>report failure</strong> when the choices are exhausted;</li>
<li><code>assignments</code>—to intercept failures and <strong>undo</strong> assignments during
backtracking.</li>
</ul>
<p>Failures are <strong>initiated</strong> only when encountered a dead end. This occurs if</p>
<ul>
<li>user program executes (amb) ( no choice any more )</li>
<li>user types <code>try-again</code> at the top-level driver</li>
</ul>
<p>Failure continuations are also <strong>called</strong> during processing of a failure</p>
<p>in order to <em>propagate</em> failure back to the choice point or to the top level:</p>
<ul>
<li>When failure continuation created by an <em>assignment</em> finish undoing, it <strong>calls</strong> the failure continuation it intercepted,</li>
<li>When failure continuation for an <em>amb</em> runs out of choices, it <strong>calls</strong> the failure continuation that was originally given to the amb</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Structure of the evaluator</strong></p>
<p>amb evaluator</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">ambeval</span> exp env succeed fail)</span>
<span class="line">	((<span class="name">analyze</span> exp) env succeed fail))</span>
</pre></td></tr></table></figure></p>
<p>general form of an execution procedure</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">lambda</span> (<span class="name">env</span> succeed fail)</span>
<span class="line">	<span class="comment">;; succeed is (lambda (value fail) . . . )</span></span>
<span class="line">	<span class="comment">;; fail is (lambda () . . . )</span></span>
<span class="line">	. . . )</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>example: <code>amb</code></p>
<p>neo analyze ( return execution procedure )</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">analyze-amb</span> exp)</span>
<span class="line">	(<span class="name">let</span> ((<span class="name">cprocs</span> (<span class="name">map</span> analyze (<span class="name">amb-choices</span> exp))))</span>
<span class="line">		(<span class="name">lambda</span> (<span class="name">env</span> succeed fail)</span>
<span class="line">			(<span class="name">define</span> (<span class="name">try-next</span> choices)</span>
<span class="line">				(<span class="name">if</span> (<span class="name">null</span>? choices)</span>
<span class="line">					(<span class="name">fail</span>)</span>
<span class="line">					((<span class="name">car</span> choices)</span>
<span class="line">					  env</span>
<span class="line">                     <span class="comment">;success continuation</span></span>
<span class="line">					  succeed</span>
<span class="line">                     <span class="comment">;failure continuation</span></span>
<span class="line">					  (<span class="name">lambda</span> () (<span class="name">try-next</span> (<span class="name">cdr</span> choices))))))</span>
<span class="line">			(<span class="name">try-next</span> cprocs))))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>Driver loop</strong></p>
<p>either calls <code>try-again</code> in response to the user typing try-again at the driver loop</p>
<p>or else starts a new evaluation by calling <code>ambeval</code>.</p>
<p>&lt;br/&gt;</p>
<h3>4.4 Logic Programming</h3>
<p>computer science deals with <strong>imperative</strong> (how to) knowledge, whereas</p>
<p>mathematics deals with <strong>declarative</strong> (what is) knowledge.</p>
<p>&lt;br/&gt;</p>
<p>Bias</p>
<ul>
<li>programming is about constructing algorithms for computing <strong>unidirectional functions</strong>  (computations with well-defined inputs and outputs)</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Example of logical programming</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">append</span> x y)</span>
<span class="line">	(<span class="name">if</span> (<span class="name">null</span>? x) y (<span class="name">cons</span> (<span class="name">car</span> x) (<span class="name">append</span> (<span class="name">cdr</span> x) y))))</span>
</pre></td></tr></table></figure></p>
<p><code>append</code> procedure can be regard as two <strong>rules</strong> translate into lisp</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">y = y append '()</span>
<span class="line">( <span class="name">cons</span> u v ) append y = ( <span class="name">cons</span> u z ) IF v appedn y = z</span>
</pre></td></tr></table></figure></p>
<p>In a logic programming language, the programmer writes an append
“procedure” by stating the <strong>two rules ( What is append )</strong> about append given above.</p>
<p><strong>“How to”</strong> knowledge is provided automatically by the interpreter</p>
<p>&lt;br/&gt;</p>
<p><strong>query language</strong></p>
<ul>
<li>our logic programming language</li>
<li>primitive: pattern ?x</li>
<li>compound: and, or, not</li>
<li>means of abstraction: rules</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>4.4.1 Deductive Information Retrieval</strong></p>
<p>Simple queries</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">;;; Query input:</span></span>
<span class="line">(<span class="name">job</span> ?x (<span class="name">computer</span> programmer))</span>
<span class="line"><span class="comment">;;; Query results:</span></span>
<span class="line">(<span class="name">job</span> (<span class="name">Hacker</span> Alyssa P) (<span class="name">computer</span> programmer))</span>
<span class="line">(<span class="name">job</span> (<span class="name">Fect</span> Cy D) (<span class="name">computer</span> programmer))</span>
</pre></td></tr></table></figure></p>
<p>Compound queries</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">and</span> (<span class="name">job</span> ?person (<span class="name">computer</span> programmer))</span>
<span class="line">	(<span class="name">address</span> ?person ?where))</span>
</pre></td></tr></table></figure></p>
<p>Rules</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">;⟨ conclusion ⟩ is a pattern and ⟨ body ⟩ is any query.</span></span>
<span class="line"><span class="comment">; ?first satisfy conclusion than apply body</span></span>
<span class="line">(<span class="name">rule</span> ⟨ conclusion ⟩ ⟨ body ⟩ )</span>
</pre></td></tr></table></figure></p>
<p>Logic as programs ( implement our append in logical language )</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">rule</span> (<span class="name">append-to-form</span> () ?y ?y))</span>
<span class="line">(<span class="name">rule</span> (<span class="name">append-to-form</span> (?u . ?v) ?y (?u . ?z))</span>
<span class="line">	  (<span class="name">append-to-form</span> ?v ?y ?z))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>4.4.2 How the Query System Works</strong></p>
<p><em>Implement query evaluator</em></p>
<ul>
<li>must perform some kind of <strong>search</strong> in order to match queries against facts and rules in the data base.</li>
</ul>
<p>Approaches</p>
<ul>
<li>nondeterministic program</li>
<li><strong>Search with the aid of streams</strong></li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Pattern matching</strong></p>
<ul>
<li>evaluate primitive and compound</li>
</ul>
<p>Pattern Matcher Input</p>
<ul>
<li>a pattern</li>
<li>a datum</li>
<li>a <strong>frame</strong> that specifies <strong>bindings</strong> for various pattern variables.</li>
</ul>
<p>Pattern Matcher Output</p>
<ul>
<li>returns the given <strong>frame</strong> <strong>augmented</strong> by any <strong>bindings</strong> that may have been determined by the match.</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524817445/Screenshot_from_2018-04-27_16-22-18.png" alt=""></p>
<p><strong>Compound queries</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524817445/Screenshot_from_2018-04-27_16-22-24.png" alt=""></p>
<p><strong>Unification</strong></p>
<ul>
<li>evaluate rules</li>
<li>a generalization of pattern matching</li>
<li>which both the “pattern” and the “datum” may contain variables.</li>
</ul>
<p><strong>Applying rules</strong></p>
<p>similar to applying a procedure in the eval / apply</p>
<p>&lt;br/&gt;</p>
<p><strong>4.4.3 Is Logic Programming Mathematical Logic?</strong></p>
<p>No</p>
<p>Query language provides a <strong>control structure</strong> that interprets the logical statements <strong>procedurally</strong>.</p>
<p>&lt;br/&gt;</p>
<p>Differences</p>
<ul>
<li>Take advantage in efficiency</li>
</ul>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">;while less supervisor than programmers</span></span>
<span class="line">(<span class="name">and</span> (<span class="name">job</span> ?x (<span class="name">computer</span> programmer)) (<span class="name">supervisor</span> ?x ?y))</span>
<span class="line">(<span class="name">and</span> (<span class="name">supervisor</span> ?x ?y) (<span class="name">job</span> ?x (<span class="name">computer</span> programmer)))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<ul>
<li>Infinite loops</li>
</ul>
<p>whether the system will find the simple answer (married Minnie Mickey) <strong>before</strong> it goes into the loop depends on implementation details concerning <strong>the order in which the system checks</strong> the items in the data base.</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">;assert rules</span></span>
<span class="line">(<span class="name">assert!</span> (<span class="name">rule</span> (<span class="name">married</span> ?x ?y) (<span class="name">married</span> ?y ?x)))</span>
<span class="line"><span class="comment">;query</span></span>
<span class="line">(<span class="name">married</span> Mickey ?who)</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<ul>
<li>Problems with not</li>
</ul>
<p>not</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">;input empty frame where x unbound, \not filters out frames, return empty stream </span></span>
<span class="line">(<span class="name">and</span> (<span class="name">not</span> (<span class="name">job</span> ?x (<span class="name">computer</span> programmer)))</span>
<span class="line">	 (<span class="name">supervisor</span> ?x ?y))</span>
</pre></td></tr></table></figure></p>
<p>not of logic programming languages reflects the so-called <em>closed world assumption</em> that all relevant information has been included in the data base.（见脚注)</p>
<p>&lt;br/&gt;</p>
<p><strong>4.4.4 Implementing the Query System</strong></p>
<p>4.4.4.1 The Driver Loop and Instantiation</p>
<p>4.4.4.2 The Evaluator</p>
<p>4.4.4.3 Finding Assertions by Pattern Matching</p>
<p>4.4.4.4 Rules and Unification</p>
<p>4.4.4.5 Maintaining the Data Base</p>
<p>4.4.4.6 Stream Operations</p>
<p>4.4.4.7 Query Syntax Procedures</p>
<p>4.4.4.8 Frames and Bindings</p>
<p>&lt;br/&gt;</p>
<p>もう...続けない.....なわけないだろ！</p>
<p><img src="https://cache.cswsadlab.com/wp-content/uploads/2017/06/UchuuPatrolLuluco_Poster_Alt2.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/18/SICP/sicp3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/18/SICP/sicp3/" itemprop="url">[SICP-ch3] Modularity, Objects, and State</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-18T22:46:51+08:00">
                2018-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SICP/" itemprop="url" rel="index">
                    <span itemprop="name">SICP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/18/SICP/sicp3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/18/SICP/sicp3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>ch-3 Modularity, Objects, and State</h2>
<h3>3.1 Assignment and Local State</h3>
<p>System decomposed into <strong>computational objects</strong> with time-varying <strong>state</strong></p>
<p>language must provide an <strong>assignment</strong> operator to enable us to change the value</p>
<p>&lt;br/&gt;</p>
<p><strong>3.1.1 Local State Variables</strong></p>
<p><em>model the situation of withdrawing money from a bank account</em></p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">make-withdraw</span> balance)</span>
<span class="line">	(<span class="name">lambda</span> (<span class="name">amount</span>)</span>
<span class="line">		(<span class="name">if</span> (<span class="name">&gt;=</span> balance amount)</span>
<span class="line">			(<span class="name">begin</span> (<span class="name">set!</span> balance (<span class="name">-</span> balance amount))</span>
<span class="line">				   balance)</span>
<span class="line">			<span class="string">"Insufficient funds"</span>)))</span>
</pre></td></tr></table></figure></p>
<p>&lt;!-- more --&gt;</p>
<p>&lt;br/&gt;</p>
<p><strong>3.1.2 The Benefits of Introducing Assignment</strong></p>
<p>viewing systems as collections of objects with local state is a powerful technique for maintaining a <strong>modular</strong> design</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> rand (<span class="name">let</span> ((<span class="name">x</span> random-init))</span>
<span class="line">	(<span class="name">lambda</span> ()</span>
<span class="line">		(<span class="name">set!</span> x (<span class="name">rand-update</span> x))</span>
<span class="line">		x)))</span>
<span class="line"></span>
<span class="line">(<span class="name">define</span> (<span class="name">cesaro-test</span>)</span>
<span class="line">	(<span class="name">=</span> (<span class="name">gcd</span> (<span class="name">rand</span>) (<span class="name">rand</span>)) <span class="number">1</span>))</span>
</pre></td></tr></table></figure></p>
<ul>
<li>assignment <strong>encapsulates the state</strong> of the random-number generator within the rand procedure,</li>
<li>so that the details of random-number generation remain <strong>independent</strong> of the rest of the program</li>
<li>therefore easy to isolate the Monte Carlo idea</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>3.1.3 The Costs of Introducing Assignment</strong></p>
<p>the substitution model failed</p>
<p>&lt;br/&gt;</p>
<p><strong>functional programming</strong></p>
<ul>
<li>Programming without assignments</li>
</ul>
<ul>
<li>procedure with the same arguments will produce the same result</li>
<li>can be viewed as computing mathematical functions</li>
</ul>
<p><strong>imperative programming</strong></p>
<ul>
<li>using explicit assignment to update the values</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Pitfalls</p>
<ul>
<li>the order of the assignments</li>
<li>several processes execute concurrently</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Sameness and change</strong></p>
<p>referentially transparent</p>
<ul>
<li>A language that supports the concept that “equals can be substituted for equals”</li>
</ul>
<p>violated when we include set!</p>
<ul>
<li>cannot determine sameness without observing the effects of change</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>3.2 The Environment Model of Evaluation</h3>
<p>A variable can no longer be considered to be a name for a value,</p>
<p>but designate a “place” in which values can be stored</p>
<p>&lt;br/&gt;</p>
<p>Environment</p>
<ul>
<li>a sequence of frames</li>
<li>each frame is a table of bindings, associate name and value</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>3.2.1 The Rules for Evaluation</strong></p>
<p>Define procedure</p>
<ul>
<li>a procedure is always a pair -- consisting of some code and a pointer to an environment</li>
<li>define creates definitions by adding bindings to frames</li>
</ul>
<p>Apply procedure</p>
<ul>
<li>create a new environment -- containing a frame that binds the parameters to the arguments' value</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524042522/Screenshot_from_2018-04-17_09-30-28.png" alt=""></p>
<p><strong>3.2.2 Applying Simple Procedures</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524042521/Screenshot_from_2018-04-17_09-34-02.png" alt=""></p>
<p>each call to square creates a new environment containing a binding for x</p>
<p>&lt;br/&gt;</p>
<p><strong>3.2.3 Frames as the Repository of Local State</strong></p>
<p>how procedures and assignment can be used to represent objects with local state</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524042521/Screenshot_from_2018-04-17_09-36-07.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p><strong>3.2.4 Internal Definitions</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524042521/Screenshot_from_2018-04-17_09-38-23.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p>make local procedure definitions a useful technique for modularizing programs</p>
<ul>
<li>local names do not interfere external names</li>
<li>local procedures can access the arguments of the enclosing procedure</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>3.3 Modeling with Mutable Data</h3>
<p>Mutators</p>
<ul>
<li>Data abstraction modify compound data objects</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>3.3.1 Mutable List Structure</strong></p>
<ul>
<li><code>set-car!</code> and <code>set-cdr!</code></li>
<li>modify car &amp; cdr pointer</li>
</ul>
<p>Sharing and identity</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524042522/Screenshot_from_2018-04-17_09-57-07.png" alt=""></p>
<p>use the predicate eq? to detect sharing in list structures</p>
<p>&lt;br/&gt;</p>
<p><strong>3.3.2 Representing Queues</strong></p>
<p><code>( insert-queue! &lt;queue&gt; &lt;item&gt; )</code></p>
<p><code>( delete-queue! &lt;queue&gt; &lt;item )</code></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524042522/Screenshot_from_2018-04-17_10-01-27.png" alt=""></p>
<p>​</p>
<p>&lt;br/&gt;</p>
<p><strong>3.3.3 Representing Tables</strong></p>
<p><code>assoc</code> returns the record that has the given key as its car</p>
<p><code>lookup</code> then checks to see that the resulting record returned by assoc is not false, and returns the value ( the cdr ) of the record</p>
<p><code>insert</code>first see if there is already a record, if not, consing key and value than insert in table</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524042522/Screenshot_from_2018-04-17_10-29-27.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p><strong>3.3.4 A Simulator for Digital Circuits</strong></p>
<p>event-driven simulation</p>
<ul>
<li>actions (“events”) trigger further events that happen at a later time, which in turn trigger more events</li>
</ul>
<p><code>wires</code> carry digital signals</p>
<p><code>function boxes</code> connect wires carrying input signals to other output wires</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">inverter</span> input output)</span>
<span class="line">	(<span class="name">define</span> (<span class="name">invert-input</span>)</span>
<span class="line">		(<span class="name">let</span> ((<span class="name">new-value</span> (<span class="name">logical-not</span> (<span class="name">get-signal</span> input))))	</span>
<span class="line">			(<span class="name">after-delay</span> inverter-delay</span>
<span class="line">				(<span class="name">lambda</span> () (<span class="name">set-signal!</span> output new-value)))))</span>
<span class="line">		(<span class="name">add-action!</span> input invert-input) 'ok)</span>
<span class="line"></span>
<span class="line">(<span class="name">define</span> (<span class="name">after-delay</span> delay action)</span>
<span class="line">	(<span class="name">add-to-agenda!</span> (<span class="name">+</span> delay (<span class="name">current-time</span> the-agenda))</span>
<span class="line">					action</span>
<span class="line">					the-agenda))</span>
</pre></td></tr></table></figure></p>
<p><code>agenda</code> contains a schedule of things to do</p>
<p><code>propagate</code>executing each procedure on the agenda in sequence</p>
<p>&lt;br/&gt;</p>
<p><strong>3.3.5 Propagation of Constraints</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1524042522/Screenshot_from_2018-04-17_10-40-49.png" alt=""></p>
<p>&lt;br/&gt;</p>
<h3>3.4 Concurrency: Time Is of the Essence</h3>
<p>by introducing assignment, we are forced to admit <strong>time</strong> into our computational models</p>
<p>Objects in the world are acting <strong>concurrently</strong> —all at once.</p>
<p>&lt;br/&gt;</p>
<p><strong>3.4.1 The Nature of Time in Concurrent Systems</strong></p>
<p>&lt;br/&gt;</p>
<p><strong>3.4.2 Mechanisms for Controlling Concurrency</strong></p>
<p>using serializer</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">make-account</span> balance)	</span>
<span class="line">	(<span class="name">let</span> ((<span class="name">protected</span> (<span class="name">make-serializer</span>)))</span>
<span class="line">		(<span class="name">define</span> (<span class="name">dispatch</span> m)</span>
<span class="line">			(<span class="name">cond</span> ((<span class="name">eq</span>? m 'withdraw) (<span class="name">protected</span> withdraw))</span>
<span class="line">				  ((<span class="name">eq</span>? m 'deposit) (<span class="name">protected</span> deposit))</span>
<span class="line">				  ((<span class="name">eq</span>? m 'balance) balance)</span>
<span class="line">				  (<span class="name">else</span> (<span class="name">error</span> <span class="string">"Unknown request: MAKE-ACCOUNT"</span> m))))</span>
<span class="line">dispatch))</span>
</pre></td></tr></table></figure></p>
<p><em>With this implementation, two processes cannot be withdrawing from or depositing into a single account concurrently.</em></p>
<p>&lt;br/&gt;</p>
<p>Complexity</p>
<ul>
<li>concurrent programming can be treacherously difficult when there are <strong>multiple shared resources</strong></li>
</ul>
<p>Implementing serializers</p>
<ul>
<li>synchronization mechanism called a mutex ( acquired &amp; release )</li>
</ul>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">make-mutex</span>)</span>
<span class="line">	(<span class="name">let</span> ((<span class="name">cell</span> (<span class="name">list</span> false)))</span>
<span class="line">		(<span class="name">define</span> (<span class="name">the-mutex</span> m)</span>
<span class="line">			(<span class="name">cond</span> ((<span class="name">eq</span>? m 'acquire)</span>
<span class="line">				   (<span class="name">if</span> (<span class="name">test-and-set!</span> cell)</span>
<span class="line">						(<span class="name">the-mutex</span> 'acquire)))<span class="comment">; retry</span></span>
<span class="line">				  ((<span class="name">eq</span>? m 'release) (<span class="name">clear!</span> cell))))</span>
<span class="line">		the-mutex))</span>
<span class="line"></span>
<span class="line"><span class="comment">;actual implementation depends on how our system runs concurrent processes</span></span>
<span class="line">(<span class="name">define</span> (<span class="name">test-and-set!</span> cell)</span>
<span class="line">	(<span class="name">if</span> (<span class="name">car</span> cell) true (<span class="name">begin</span> (<span class="name">set-car!</span> cell true) false)))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>Deadlock</strong></p>
<ul>
<li>Each process is stalled forever, waiting for the other</li>
</ul>
<p><strong>Concurrency, time, and communication</strong></p>
<p>The basic phenomenon here is that <em>synchronizing</em> different processes, establishing <em>shared state</em>, or imposing an <em>order</em> on events requires <strong>communication among the processes</strong>.</p>
<p>&lt;br/&gt;</p>
<h3>3.5 Streams</h3>
<p><em>an alternative approach to modeling state</em></p>
<p>&lt;br/&gt;</p>
<p>Computational Object</p>
<table>
<thead>
<tr>
<th>real-world</th>
<th>computer</th>
</tr>
</thead>
<tbody>
<tr>
<td>real-world objects with local state</td>
<td>computational objects with local variables</td>
</tr>
<tr>
<td>time variation in the real world</td>
<td>time variation in the computer</td>
</tr>
<tr>
<td>implement the time variation of the states</td>
<td>assignments to the local variables</td>
</tr>
</tbody>
</table>
<p>&lt;br/&gt;</p>
<p>streams</p>
<ul>
<li>model change in terms of sequences that represent the time histories</li>
</ul>
<p><strong>3.5.1 Streams Are Delayed Lists</strong></p>
<p>Streams allows one to formulate programs as <strong>sequence</strong> manipulations, while ataining the <strong>efficiency</strong> of incremental computation.</p>
<p>&lt;br/&gt;</p>
<p><strong>basic idea</strong></p>
<ul>
<li>construct a stream only partially</li>
<li>when accessed, automatically construct just enough more of itself to produce the required part</li>
<li>preserving the <strong>illusion</strong> that the entire stream exists</li>
</ul>
<p><strong>Delayed Evaluation</strong></p>
<p>cons-stream</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">cons-stream</span> ⟨ a ⟩ ⟨ b ⟩ </span>
<span class="line">		== (<span class="name">cons</span> ⟨ a ⟩ (<span class="name">delay</span> ⟨ b ⟩ )) )</span>
</pre></td></tr></table></figure></p>
<p>selectors</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">stream-car</span> stream) (<span class="name">car</span> stream))</span>
<span class="line">(<span class="name">define</span> (<span class="name">stream-cdr</span> stream) (<span class="name">force</span> (<span class="name">cdr</span> stream)))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Implementing delay and force</p>
<ul>
<li><code>delay</code> must package an expression so that it can be evaluated late</li>
</ul>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">delay</span> ⟨ exp ⟩ )</span>
<span class="line">		== (<span class="name">lambda</span> () ⟨ exp ⟩ )</span>
</pre></td></tr></table></figure></p>
<ul>
<li><code>force</code> simply calls the procedure (of no arguments)</li>
</ul>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">force</span> delayed-object) (<span class="name">delayed-object</span>))</span>
</pre></td></tr></table></figure></p>
<ul>
<li>Optimization for forcing the same delayed object: Memoize</li>
</ul>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">delay</span> ⟨ exp ⟩ )</span>
<span class="line">		== (<span class="name">memo-proc</span> (<span class="name">lambda</span> () ⟨ exp ⟩ ))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>3.5.2 Infinite Streams</strong></p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">integers-starting-from</span> n)</span>
<span class="line">		(<span class="name">cons-stream</span> n (<span class="name">integers-starting-from</span> (<span class="name">+</span> n <span class="number">1</span>))))</span>
<span class="line">(<span class="name">define</span> integers (<span class="name">integers-starting-from</span> <span class="number">1</span>))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Defining streams implicitly</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> fibs</span>
<span class="line">		(<span class="name">cons-stream</span></span>
<span class="line">		<span class="number">0</span></span>
<span class="line">		(<span class="name">cons-stream</span> <span class="number">1</span> (<span class="name">add-streams</span> (<span class="name">stream-cdr</span> fibs) fibs))))</span>
</pre></td></tr></table></figure></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523543773/Screenshot_from_2018-04-12_22-32-39.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p><strong>3.5.3 Exploiting the Stream Paradigm</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523543772/Screenshot_from_2018-04-12_22-31-42.png" alt=""></p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">pi-summands</span> n)</span>
<span class="line">		(<span class="name">cons-stream</span> (<span class="name">/</span> <span class="number">1.0</span> n)</span>
<span class="line">			(<span class="name">stream-map</span> - (<span class="name">pi-summands</span> (<span class="name">+</span> n <span class="number">2</span>)))))</span>
<span class="line">(<span class="name">define</span> pi-stream</span>
<span class="line">		(<span class="name">scale-stream</span> (<span class="name">partial-sums</span> (<span class="name">pi-summands</span> <span class="number">1</span>)) <span class="number">4</span>))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>sequence accelerator</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523543773/Screenshot_from_2018-04-12_22-34-11.png" alt=""></p>
<p>Even better, we can accelerate the accelerated sequence, and recursively accelerate that, and so on.</p>
<p>&lt;br/&gt;</p>
<p>Infinite streams of pairs</p>
<p><em>interleave</em></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523543773/Screenshot_from_2018-04-12_22-35-17.png" alt=""></p>
<p>Streams as signals</p>
<p><em>signal-processing systems that contain <strong>feedback</strong> loops</em></p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">integral</span> integrand initial-value dt)</span>
<span class="line">	(<span class="name">define</span> int</span>
<span class="line">		(<span class="name">cons-stream</span> initial-value</span>
<span class="line">			(<span class="name">add-streams</span> (<span class="name">scale-stream</span> integrand dt)</span>
<span class="line">						  int)))</span>
<span class="line">int)</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>3.5.4 Streams and Delayed Evaluation</strong></p>
<p>Unfortunately, stream models of systems with loops may require uses of <strong>delay beyond the “hidden” delay</strong> supplied by cons-stream .</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">;does not work, because in the first line of solve the call to integral requires that the input dy be defined, which does not happen until the second line of solve</span></span>
<span class="line"></span>
<span class="line">(<span class="name">define</span> (<span class="name">solve</span> f y0 dt)</span>
<span class="line">		(<span class="name">define</span> y (<span class="name">integral</span> dy y0 dt))</span>
<span class="line">		(<span class="name">define</span> dy (<span class="name">stream-map</span> f y))</span>
<span class="line">		y)</span>
<span class="line"></span>
<span class="line"><span class="comment">;Correct Definition</span></span>
<span class="line">(<span class="name">define</span> (<span class="name">solve</span> f y0 dt)</span>
<span class="line">		(<span class="name">define</span> y (<span class="name">integral</span> (<span class="name">delay</span> dy) y0 dt))</span>
<span class="line">		(<span class="name">define</span> dy (<span class="name">stream-map</span> f y))</span>
<span class="line">		y)</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>Normal-order evaluation</strong></p>
<p>Delay and Force</p>
<ul>
<li>provides great programming <strong>flexibility</strong></li>
<li>but also can make our programs more <strong>complex</strong></li>
</ul>
<p>normal-order evaluation language ( Section 4.2 )</p>
<ul>
<li>all arguments to procedures are automatically delayed</li>
</ul>
<ul>
<li>arguments are forced only when they are actually needed</li>
</ul>
<p><strong>Mutability</strong> and <strong>Delayed evaluation</strong> do not mix well</p>
<ul>
<li>Unfortunately, including delays in procedure calls wreaks-havoc(破坏) with our ability to design programs that depend on the <strong>order of events</strong></li>
<li>such as programs that use assignment, mutate data, or perform input or output.</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>3.5.5 Modularity of Functional Programs and Modularity of Objects</strong></p>
<p>benefits of Assignment</p>
<ul>
<li>increase the modularity by encapsulating states</li>
</ul>
<p>Stream can provide an <strong>equivalent modularity</strong> without assignment.</p>
<p>&lt;br/&gt;</p>
<p><strong>A functional-programming view of time</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">Modeling with objects</th>
<th style="text-align:center">Functional programming language</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Assignment and Mutable objects</td>
<td style="text-align:center">Stream that represents the time history of states</td>
</tr>
<tr>
<td style="text-align:center">matches the way interacting with the world</td>
<td style="text-align:center">well-defined mathematical functions whose behavior does not change</td>
</tr>
<tr>
<td style="text-align:center">raise problems of constraining the order and syncronizing</td>
<td style="text-align:center">raise problems when we wish to design interactive systems</td>
</tr>
</tbody>
</table>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523543772/Screenshot_from_2018-04-12_22-29-47.png" alt=""></p>
<p>We can model the world as <strong>a collection of separate, time-bound, interacting objects with state</strong>, or we can model the world as <strong>a single, timeless, stateless unity</strong>.</p>
<p>Each view has powerful advantages, but <strong>neither</strong> view alone is completely satisfactory. A grand unification has yet to emerge</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/NeuralNet/3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/NeuralNet/3/" itemprop="url">[NN&DL-ch3] Improving the way neural networks learn</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T20:38:47+08:00">
                2018-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NeuralNet/" itemprop="url" rel="index">
                    <span itemprop="name">NeuralNet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/15/NeuralNet/3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/15/NeuralNet/3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>ch-3 Improving the way neural networks learn</h2>
<p>The techniques we'll develop in this chapter include</p>
<ul>
<li>a better choice of <strong>cost function</strong>, the cross-entropy cost function;</li>
<li>four so-called <strong>&quot;regularization&quot;</strong> methods ( L1 and L2 regularization, dropout, and artificial expansion of the training data ), which make our networks better at generalizing beyond the training data;</li>
<li>a better method for <strong>initializing the weights</strong> in the network;</li>
<li>a set of heuristics to help choose <strong>good hyper-parameters</strong> ;</li>
</ul>
<p>&lt;!-- more --&gt;
&lt;br/&gt;</p>
<h3>The cross-entropy cost function</h3>
<p><strong>Problem of quadratic function</strong></p>
<p>Artificial neuron has a lot of difficulty learning when it's badly wrong</p>
<p>w = b = 2.0,  η = 0.15</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866343/Screenshot_from_2018-04-13_06-08-17.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p>Quadratic cost function $ C = \frac { (y-a) ^ 2 }{ 2 }  $</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866343/Screenshot_from_2018-04-13_06-12-32.png" alt=""></p>
<ul>
<li>when the neuron's output is close to 1  ( might be far away from the desired output )</li>
<li>the curve gets very flat, so $ σ′(z) $ gets very small.</li>
<li>so $ ∂C/∂w $ and $ ∂C/∂b $ get very small.</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Introducing cross-entropy</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866343/Screenshot_from_2018-04-13_06-22-52.png" alt=""></p>
<p>where $ a = σ(z) $ and $ z= \Sigma_j w_jx_j + b $</p>
<ol>
<li>It's a cost function :</li>
</ol>
<ul>
<li>non-negative</li>
<li>close to zero when a close to y</li>
</ul>
<ol start="2">
<li>avoids the problem of learning slowing down</li>
</ol>
<ul>
<li>rates not controlled by $ σ'(z) $</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866343/Screenshot_from_2018-04-13_06-23-37.png" alt=""></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866343/Screenshot_from_2018-04-16_05-25-49.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p>Using the <strong>quadratic cost</strong> when we have <strong>linear</strong> neurons in the output layer</p>
<ul>
<li>all the neurons in the final layer are <em>linear neurons</em></li>
<li>outputs are simply $ a_j^L = y_j^L $, sigmoid not applied</li>
<li>quadratic cost will not slowdown learning</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>Softmax</h3>
<ul>
<li>define a new type of <strong>output</strong> layer</li>
<li>apply the so-called softmax function to z</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866343/Screenshot_from_2018-04-16_05-39-16.png" alt=""></p>
<p>output is a set of <strong>positive</strong> numbers <strong>which sum up to 1</strong>, can be thought of as a <strong>probability distribution</strong></p>
<p>&lt;br/&gt;</p>
<p><strong>The learning slowdown problem</strong></p>
<p><strong>log-likelihood</strong> cost function</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866343/Screenshot_from_2018-04-16_05-46-28.png" alt=""></p>
<p>probability of $ a_y^L $ close to 1, cost close to 0</p>
<p>$ δ_j ^L =  \partial C / \partial z_j^L $</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866343/Screenshot_from_2018-04-16_05-56-06.png" alt=""></p>
<p>&lt;br/&gt;</p>
<h3>Overfitting</h3>
<p><strong>cost</strong> on the <strong>training data</strong> continue decrease while</p>
<p>classification <strong>accuracy</strong> on the <strong>test data</strong> stops</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_13-09-23.png" alt=""></p>
<p><strong>cost</strong> on the <strong>test data</strong> starts increase while</p>
<p>classification <strong>accuracy</strong> on <strong>training data</strong> rises up to 100%</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_13-13-09.png" alt=""></p>
<p><em>It's almost as though our network is <strong>merely memorizing</strong> the <strong>training</strong> set, without understanding digits well enough to generalize to the test set.</em></p>
<p>&lt;br/&gt;</p>
<p>Detect overfitting</p>
<ul>
<li>keeping track of accuracy on the test data as our network trains.</li>
<li>using validation data: we may find hyper-parameters which fit particular peculiarities of the test_data if using test_data for detection.</li>
<li><em>early stopping</em>: stop training when accuracy no longer improving</li>
<li><em>hold out method</em>: validation_data is kept apart or &quot;held out&quot; from the training_data</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Avoid overfitting</strong></p>
<ul>
<li>one of the <strong>best</strong> ways: increase the <strong>size</strong> of the training data</li>
<li>regularization</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>Regularization</h3>
<h4>L2 regularization ( weight decay )</h4>
<p>add an extra term on cost function</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_13-31-41.png" alt=""></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_13-34-29.png" alt=""></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_13-34-40.png" alt=""></p>
<ul>
<li>Intuitively, the effect of regularization is to make it so the network <strong>prefers to learn small weights</strong></li>
<li>λ : compromising between finding small weights and minimizing the original cost function</li>
<li>$ -\frac{ηλ}{n}*w  $ weights shrink by an amount <strong>proportional</strong> to w</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Why does regularization help reduce overfitting?</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_13-38-21.png" alt=""></p>
<p><em>the 9th order model is really just learning the effects of <strong>local noise</strong></em></p>
<ul>
<li>The smallness of the <strong>weights</strong> means that the network <strong>won't change too much</strong> if we change a few random inputs here and there</li>
<li>having a large <strong>bias</strong> doesn't make a neuron sensitive to its inputs in the same way as having large weights</li>
</ul>
<p>We don't have an entirely satisfactory systematic understanding of what's going on, <strong>merely incomplete heuristics</strong> and rules of thumb.</p>
<p>&lt;br/&gt;</p>
<h4>L1 regularization</h4>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_14-36-53.png" alt=""></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_14-37-21.png" alt=""></p>
<ul>
<li>$ -\frac{ηλ}{n} * sgn(w) $weights shrink by a <strong>constant</strong> amount toward 0</li>
<li>when $|w| $ is large, shrink less; when $ |w| $ is small, shrink more</li>
</ul>
<p>&lt;br/&gt;</p>
<h4>Dropout</h4>
<p><strong>modify the network itself</strong> rather than modifying the cost function</p>
<ul>
<li>start by <strong>randomly deleting half the hidden neurons</strong></li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866345/Screenshot_from_2018-04-16_14-47-37.png" alt=""></p>
<ul>
<li>forward-propagate the input and backpropagate the result, update network</li>
<li>choosing a new random subset,  repeat;</li>
<li>Finally, run the full network by <strong>halving</strong> all weights.</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Heuristic</p>
<ul>
<li><strong>Averaging</strong> the effects of <strong>a large number of</strong> different networks</li>
<li>a neuron cannot <strong>rely on</strong> particular other neurons, <strong>robust</strong> to losing any individual connection</li>
</ul>
<p>&lt;br/&gt;</p>
<h4>Artificially expanding the training data</h4>
<p>The general principle is to expand the training data by applying operations that <strong>reflect real-world variation</strong>.</p>
<p>&lt;br/&gt;</p>
<p><strong>An aside on big data and what it means to compare classification accuracies</strong></p>
<p><strong>more training data</strong> can sometimes compensate for differences in the machine learning algorithm used</p>
<p>&lt;br/&gt;</p>
<h3>Weight initialization</h3>
<p><em>Up to now</em></p>
<ul>
<li>choose w &amp; b using independent <em>Gaussian random variables</em></li>
<li>mean 0 and standard deviation 1</li>
<li>while z <strong>sum up</strong> over a total of 501 normalized Gaussian random variables</li>
<li>z will have a very broad Gaussian distribution</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866344/Screenshot_from_2018-04-16_15-01-47.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p>An easy way</p>
<ul>
<li>initialize more sharply peak</li>
<li>mean 0 and standard deviation $ 1 / \sqrt {n_{in}} $</li>
<li>seems only speeds up learning, doesn't change the final performance</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866345/Screenshot_from_2018-04-16_15-08-29.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p><strong>Connection with Regularization</strong></p>
<ul>
<li>L2 regularization sometimes automatically gives us something similar to the new approach to weight initialization</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>Handwriting recognition revisited: the code</h3>
<p>&lt;br/&gt;</p>
<p>&lt;br/&gt;</p>
<h3>How to choose a neural network's hyper-parameters?</h3>
<p>Problem when choose η=10.0 and λ=1000.0</p>
<ul>
<li>classification accuracies are no better than <strong>chance</strong></li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Broad strategy</strong></p>
<ul>
<li>examine network to achieve results better than chance</li>
</ul>
<p>Speed up experimentation</p>
<ul>
<li>stripping network down to the <strong>simplest</strong></li>
<li>increasing the <strong>frequency of monitoring</strong></li>
</ul>
<p>When having a signal</p>
<ul>
<li>gradually decrease the frequency of monitoring</li>
</ul>
<ul>
<li>experiment with a more complex architecture, adjust  η and λ again</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Learning Rate</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866345/Screenshot_from_2018-04-16_15-33-45.png" alt=""></p>
<ul>
<li>First estimate the <strong>order of threshold</strong> for η so that <strong>training cost</strong> won't oscillating or increasing</li>
<li>control the step size in gradient descent, no need to monitor by accuracy</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Number of training Epochs</strong></p>
<p>Early stopping</p>
<ul>
<li>terminate when classification on validation data stops improving</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Learning rate schedule</strong></p>
<ul>
<li>μ=0 there's a lot of friction, the velocity can't build upuse a large learning rate when weights are badly wrong</li>
<li>later reduce as we make more fine-tuned adjustments</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>The regularization parameter, λ</strong></p>
<ul>
<li>starting initially λ=0.0 to determine 	η</li>
<li>increase or decrease by factors of 10, get a fine-tune</li>
<li>return and re-optimize η again</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Mini-batch size</strong></p>
<ul>
<li>it's possible to use <strong>matrix techniques</strong> to compute the gradient update for <em>all</em> examples in a mini-batch simultaneously</li>
<li>using the larger mini-batch would speed things up</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>Other techniques</h3>
<p>####Variations on stochastic gradient descent</p>
<p><strong>Hessian technique</strong></p>
<p>incorporates not just the gradient, but also information about <strong>how the gradient is changing</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866345/Screenshot_from_2018-04-16_15-47-58.png" alt=""></p>
<p>$ H $ is a matrix known as the <em>Hessian matrix</em>, whose $ jkth $ entry is $ ∂^2C/∂w_j∂w_k $</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866345/Screenshot_from_2018-04-16_15-48-04.png" alt=""></p>
<ul>
<li>the sheer <strong>size</strong> of the Hessian matrix make it difficult to compute</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Momentum-based gradient descent</strong></p>
<p>introduces a notion of &quot;velocity&quot; and &quot;friction&quot;</p>
<ul>
<li>replace the gradient descent update rule $ w→w′=w−η∇C$  by</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866345/Screenshot_from_2018-04-16_15-52-55.png" alt=""></p>
<ul>
<li>the &quot;force&quot; ∇C is now modifying v, and the velocity is controlling the rate of change of w.</li>
</ul>
<ul>
<li>
<p>1−μ as the amount of friction in the system.</p>
</li>
<li>
<p>μ=1, there is no friction;  μ=0 there's a lot of friction, the velocity can't build up;</p>
<p>&lt;br/&gt;</p>
</li>
</ul>
<h4>Other models of artificial neuron</h4>
<p><strong>tanh neuron</strong></p>
<ul>
<li>ranges from -1 to 1, not 0 to 1</li>
<li>allows both positive and negative activations</li>
<li>the activations in hidden layers would be equally balanced</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866345/Screenshot_from_2018-04-16_16-05-02.png" alt=""></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866346/Screenshot_from_2018-04-16_16-05-09.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p><strong>Rectified linear unit</strong></p>
<ul>
<li>never cause saturate, no corresponding learning slowdown</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866345/Screenshot_from_2018-04-16_16-07-11.png" alt=""></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1523866346/Screenshot_from_2018-04-16_16-07-17.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/NeuralNet/2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/NeuralNet/2/" itemprop="url">[NN&DL-ch2] How the backpropagation algorithm works</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T19:38:47+08:00">
                2018-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NeuralNet/" itemprop="url" rel="index">
                    <span itemprop="name">NeuralNet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/15/NeuralNet/2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/15/NeuralNet/2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>ch-2 How the backpropagation algorithm works</h2>
<p>discuss <strong>how to compute</strong> the gradient ( $\nabla C$ ) of the cost function</p>
<p>Heart of backpropagation</p>
<ul>
<li>an expression for the partial derivative $∂ C /∂ w$ of the cost function C with respect to any weight w ( or bias b ) in the network</li>
<li>tells us <strong>how quickly</strong> the cost changes when
we change the weights and biases</li>
</ul>
<p>&lt;!-- more --&gt;
&lt;br/&gt;</p>
<h3>Warm up: a fast matrix-based approach to computing the output from a neural network</h3>
<p>Notation</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522225396/Screenshot_from_2018-03-28_16-02-07.png" alt=""></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522225396/Screenshot_from_2018-03-28_16-02-14.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p>Vectorized form</p>
<ul>
<li>apply the weight matrix to the activations, then add the bias vector, and finally apply the σ function</li>
<li>$a^l=σ(w^la^{l−1}+b^l) =σ(z^l)$</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>The two assumptions we need about the cost function</h3>
<ol>
<li>the cost function can be written as an average $ C=\frac{1}{n}∑_xC_x$ over cost functions $C_x$ for individual training examples, x.</li>
<li>the cost can be written as a <strong>function of the outputs</strong> from the neural network: $cost C = C ( a^L )$</li>
</ol>
<p>&lt;br/&gt;</p>
<h3>The four fundamental equations behind backpropagation</h3>
<p>**DEF error ** $ δ^l_j $</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522225396/Screenshot_from_2018-03-28_16-16-05.png" alt=""></p>
<p><strong>Error in the output layer</strong> $δ^l$</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522225569/Screenshot_from_2018-03-28_16-25-52.png" alt=""></p>
<p><strong>Error $δ^l$ in terms of the error in the next layer, $δ^l+1$</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522225741/Screenshot_from_2018-03-28_16-28-20.png" alt=""></p>
<p><strong>Rate of change of the cost with respect to any bias</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522225741/Screenshot_from_2018-03-28_16-28-27.png" alt=""></p>
<p><strong>Rate of change of the cost with respect to any weight</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522225396/Screenshot_from_2018-03-28_16-16-48.png" alt=""></p>
<p>&lt;br/&gt;</p>
<h3>Proof of the four fundamental equations</h3>
<p>using chain rule</p>
<p>&lt;br/&gt;</p>
<h3>The backpropagation algorithm</h3>
<ul>
<li>correctness: because the cost is a function of outputs</li>
<li>To understand how the cost varies with earlier weights and biases we need to repeatedly apply the chain rule, , working backward through the layers to obtain usable expressions</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522226532/Screenshot_from_2018-03-28_16-36-52.png" alt=""></p>
<p>&lt;br/&gt;</p>
<h3>Backpropagation: the big picture</h3>
<p>a clever way of keeping track of small perturbations to the weights (and biases) as they propagate through the network, reach the output, and then affect the cost</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/13/NeuralNet/nndlch1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/13/NeuralNet/nndlch1/" itemprop="url">[NN&DL-ch1] Using neural nets to recognize handwritten digits</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-13T05:38:47+08:00">
                2018-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NeuralNet/" itemprop="url" rel="index">
                    <span itemprop="name">NeuralNet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/13/NeuralNet/nndlch1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/13/NeuralNet/nndlch1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>ch-1 Using neural nets to recognize handwritten digits</h2>
<h3>Perceptrons</h3>
<ul>
<li>a type of artificial neuron</li>
<li>a device that makes decisions by weighing up evidence</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522222646/Screenshot_from_2018-03-28_15-31-57.png" alt=""></p>
<p>&lt;!-- more --&gt;
&lt;br/&gt;</p>
<p>perceptron in higher layer</p>
<ul>
<li>make a decision at a more complex and more <strong>abstract</strong> level</li>
</ul>
<p>many-layer network of perceptrons</p>
<ul>
<li>engage in sophisticated decision making</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>weight</strong></p>
<ul>
<li>real numbers expressing the <strong>importance</strong> of the respective inputs to the output</li>
</ul>
<p><strong>bias</strong></p>
<ul>
<li>a measure of how <strong>easy</strong> it is to get the perceptron to fire</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522222646/Screenshot_from_2018-03-28_15-33-44.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p>Use perceptrons to compute any logical function</p>
<ul>
<li>NAND gate is universal for computation</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>Sigmoid neurons</h3>
<p><strong>Learning</strong></p>
<ul>
<li>DEF: changing the weights and biases over and over to produce better and better output</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Problems  of Perceptron</p>
<ul>
<li>step function</li>
</ul>
<ul>
<li>a small change in the weights or bias of any single perceptron in the network can sometimes cause the output of that perceptron to completely flip, say from 0 to 1</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522222646/Screenshot_from_2018-03-28_15-34-25.png" alt=""></p>
<p><strong>sigmoid neuron</strong></p>
<ul>
<li>Input take on values between 0 an 1</li>
</ul>
<ul>
<li>Output also between 0 and 1 which is $ σ( wx + b ) $</li>
</ul>
<p>$ σ(z) ≡ \frac { 1 }{ 1 + e ^ {-z } } $ where $ z = wx + b $</p>
<p>$  σ'(z) =  σ(z)  (1- σ(z) ) $</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522222647/Screenshot_from_2018-03-28_15-34-35.png" alt=""></p>
<ul>
<li>
<p>The smoothness of σ means that small changes $Δw_j$ in the weights and $Δb$ in the bias will produce a small change $Δoutput$ in the output from the neuron.</p>
</li>
<li>
<p>$ \Delta output \approx  \Sigma _j \frac {\partial output}{ \partial w_j} \Delta w_j  + \frac {\partial output}{ \partial b} \Delta b  $</p>
</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>The architecture of neural networks</h3>
<ul>
<li>input layer, output layer, hidden layer</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522222648/Screenshot_from_2018-03-28_15-36-05.png" alt=""></p>
<p><strong>Feed Forward Neural Networks</strong></p>
<ul>
<li>no loops in the network</li>
</ul>
<p>Recurrent neural networks</p>
<ul>
<li>feedback loops are possible</li>
<li>have neurons which fire for some limited duration of <strong>time</strong>, before becoming quiescent</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>A simple network to classify handwritten digits</h3>
<p>To recognize individual digits we will use a three-layer neural network</p>
<ul>
<li>Input: 28 by 28 pixel = 784</li>
<li>Output: 10 neurons represent for 0 to 9</li>
<li>Hidden layer: n = 15 as an example</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Output layer: why use 10 numbers rather than 4 bits?</p>
<ul>
<li>there's no easy way to relate that most significant bit to simple shapes</li>
</ul>
<p>?A way to think about Hidden layer</p>
<ul>
<li>weighting up evidence and produce an abstraction</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>Learning with gradient descent</h3>
<p><strong>cost function</strong></p>
<ul>
<li>DEF:  $ C( w,b ) ≡ \frac{1}{2n} ∑ ∥y(x) − a ∥^2 $</li>
<li>$y(x) = (0, 0, 0, 0, 0, 0, 1, 0, 0, 0)^T$ : Desired output</li>
<li>a : Output from network</li>
<li>x : input, n: number of inputs, w : weight, b : bias</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Aim of our training algorithm</strong></p>
<ul>
<li><strong>minimize</strong> the cost C (w, b) as a function of the weights and biases</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Why not try to maximize that number?</p>
<ul>
<li>the number of images correctly classified is not a smooth function of the weights and biases</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Gradient Descent Algorithm</strong></p>
<ul>
<li>repeatedly compute the gradient ∇C , and then to move in the opposite direction</li>
</ul>
<p>&lt;br/&gt;</p>
<p>$ ΔC ≈ \frac { ∂ C }{∂ w_k} Δ w_k + \frac{ ∂ C } {∂ b_l} Δ b_l  ≈ ∇C ⋅ Δv.$</p>
<p>choose Δv so as to make ΔC <strong>negative</strong></p>
<p>$Δv = −η∇C $</p>
<p>apply to each component</p>
<p>$ w_k → w_k' = w_k − η \frac{∂ C}{∂w_k }$</p>
<p>$ b_l → b_l' = b_l − η \frac{∂ C}{∂b_l }$</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522222648/Screenshot_from_2018-03-28_15-36-22.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p>Problem</p>
<ul>
<li>In practical implementations, η is often varied so that it remains a good approximation, but the algorithm is too slow</li>
</ul>
<p><strong>Stochastic gradient descent</strong></p>
<ul>
<li>used to speed up learning</li>
<li>estimate the gradient $ ∇C $ by computing $ ∇C_x $ for a small sample of randomly chosen training inputs</li>
</ul>
<p>$ w_k → w_k' = w_k − \frac{η}{m} \Sigma_j\frac{∂ C}{∂w_k }$</p>
<p>$ b_l → b_l' = b_l − \frac{η}{m}\Sigma_j \frac{∂ C}{∂b_l }$</p>
<p>&lt;br/&gt;</p>
<h3>Toward deep learning</h3>
<p>The weights and biases in the network were discovered <strong>automatically</strong>.</p>
<p>And that means we don't immediately have an <strong>explanation</strong> of how the network does what it does</p>
<p>&lt;br/&gt;</p>
<p>A heuristic</p>
<ul>
<li>we could use is to decompose the problem into <strong>sub-problems</strong></li>
<li>early layers answering very simple and specific questions about the input image</li>
<li>later layers building up a hierarchy of ever more complex and <strong>abstract</strong> concepts</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1522222649/Screenshot_from_2018-03-28_15-36-55.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/21/CSAPP/shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/21/CSAPP/shell/" itemprop="url">[CS:APP-ch8] Shell Lab</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-21T13:27:51+08:00">
                2018-03-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSAPP/" itemprop="url" rel="index">
                    <span itemprop="name">CSAPP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/21/CSAPP/shell/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/03/21/CSAPP/shell/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>[CS:APP-ch8] Shell Lab</h2>
<p>http://csapp.cs.cmu.edu/3e/labs.html</p>
<p>http://condor.depaul.edu/glancast/374class/hw/shlab-readme.html</p>
<p>https://github.com/zhoudiqiu/Shell-lab/blob/master/lab5/tsh.c</p>
<p>&lt;br/&gt;</p>
<h3>Target</h3>
<p>implement</p>
<ul>
<li>eval, builtin_cmd, do_bgfg, waitfg</li>
<li>sigchld_handler, sigint_handler, sigtstp_handler</li>
</ul>
<p>&lt;br/&gt;</p>
<p>&lt;!-- more --&gt;</p>
<h3>0. Preparation</h3>
<p><code>tshref</code>: 正确的参考shell，要求自己实现后的shell和它的结果一样</p>
<p><code>make test01</code>用trace01.txt来验证结果，可以参考<code>make rtest01</code>的结果</p>
<p><code>gdb</code> makefile去掉参数O2,加上-g</p>
<p>&lt;br/&gt;</p>
<h3>1. void eval ( char*cmdline )</h3>
<p>原型：p755</p>
<ul>
<li>If command is a built-in command, the shell program handles it immediately.</li>
<li>Otherwise, the shell creates a child process to load and execute the program for command.</li>
</ul>
<p>Hint</p>
<ul>
<li>In <code>eval</code>, the <strong>parent</strong> must use <code>sigprocmask</code>to <strong>block</strong> <code>SIGCHLD</code> signals before it forks the child, then <strong>unblock</strong> these signals, again using <code>sigprocmask</code> after it adds the child to the job list by calling <code>addjob</code>.</li>
<li>Since children inherit the blocked vectors of their parents, the <strong>child</strong> must be sure to then <strong>unblock</strong> <code>SIGCHLD</code> signals before it <code>execs</code> the new program.</li>
<li>The <strong>parent</strong> needs to <strong>block</strong> the <code>SIGCHLD</code> signals in this way in order to avoid the <strong>race</strong> condition where the child is reaped by <code>sigchld_handler</code> (and thus removed from the job list) before the parent calls addjob.</li>
<li>After the <code>fork</code>, but before the <code>execve</code>, the child process should call <code>setpgid(0, 0)</code>, which puts the child in a <strong>new</strong> process group whose group ID is identical to the child’s PID. This ensures that there will be only one process, your shell, in the <strong>foreground process group</strong>. When you type <code>ctrl-c</code>, the shell should catch the resulting <code>SIGINT</code> and then forward it to the appropriate foreground job (or more precisely, the process group that contains the foreground job).</li>
</ul>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
<span class="line">58</span>
<span class="line">59</span>
<span class="line">60</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span>
<span class="line"><span class="comment"> * eval - Evaluate the command line that the user has just typed in</span></span>
<span class="line"><span class="comment"> *</span></span>
<span class="line"><span class="comment"> * If the user has requested a built-in command (quit, jobs, bg or fg)</span></span>
<span class="line"><span class="comment"> * then execute it immediately. Otherwise, fork a child process and</span></span>
<span class="line"><span class="comment"> * run the job in the context of the child. If the job is running in</span></span>
<span class="line"><span class="comment"> * the foreground, wait for it to terminate and then return.  Note:</span></span>
<span class="line"><span class="comment"> * each child process must have a unique process group ID so that our</span></span>
<span class="line"><span class="comment"> * background children don't receive SIGINT (SIGTSTP) from the kernel</span></span>
<span class="line"><span class="comment"> * when we type ctrl-c (ctrl-z) at the keyboard.</span></span>
<span class="line"><span class="comment"> */</span></span>
<span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eval</span> <span class="params">( <span class="keyword">char</span> *cmdline )</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">pid_t</span> pid;</span>
<span class="line">    <span class="keyword">sigset_t</span> mask;</span>
<span class="line">    <span class="keyword">char</span> *argv[ MAXARGS ];</span>
<span class="line">    <span class="comment">//Parse the command line and build the argv array</span></span>
<span class="line">    <span class="keyword">int</span> bg = parseline ( cmdline, argv );</span>
<span class="line"></span>
<span class="line">    <span class="keyword">if</span> ( !builtin_cmd ( argv ) ) &#123;</span>
<span class="line"></span>
<span class="line">        <span class="comment">// blocking SIGCHLD, race</span></span>
<span class="line">        sigemptyset ( &amp;mask );</span>
<span class="line">        sigaddset ( &amp;mask, SIGCHLD );</span>
<span class="line">        sigprocmask ( SIG_BLOCK, &amp;mask, <span class="literal">NULL</span> );</span>
<span class="line"></span>
<span class="line">        <span class="comment">// fork new process</span></span>
<span class="line">        <span class="keyword">if</span> ( ( pid = fork () ) &lt; <span class="number">0</span> )</span>
<span class="line">            unix_error ( <span class="string">"fork error"</span> );</span>
<span class="line"></span>
<span class="line">        <span class="comment">// child process</span></span>
<span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( pid == <span class="number">0</span> ) &#123;</span>
<span class="line">            <span class="comment">// unblock SIGCHLD in child process</span></span>
<span class="line">            sigprocmask ( SIG_UNBLOCK, &amp;mask, <span class="literal">NULL</span> );</span>
<span class="line">            <span class="comment">// ensures that there will be only one process</span></span>
<span class="line">            setpgid ( <span class="number">0</span>, <span class="number">0</span> );</span>
<span class="line">            <span class="comment">// execute command</span></span>
<span class="line">            <span class="keyword">if</span> ( execvp ( argv[ <span class="number">0</span> ], argv ) &lt; <span class="number">0</span> ) &#123;</span>
<span class="line">                <span class="built_in">printf</span> ( <span class="string">"%s: Command not found\n"</span>, argv[ <span class="number">0</span> ] );</span>
<span class="line">                <span class="built_in">exit</span> ( <span class="number">1</span> );</span>
<span class="line">            &#125;</span>
<span class="line"></span>
<span class="line">        <span class="comment">// parent</span></span>
<span class="line">        &#125; <span class="keyword">else</span> &#123;</span>
<span class="line"></span>
<span class="line">            addjob ( jobs, pid, bg ? BG : FG, cmdline );</span>
<span class="line">            <span class="comment">// get SIGCHLD back after add job</span></span>
<span class="line">            sigprocmask ( SIG_UNBLOCK, &amp;mask, <span class="literal">NULL</span> );</span>
<span class="line"></span>
<span class="line">            <span class="keyword">if</span> ( !bg ) &#123;</span>
<span class="line">                <span class="comment">// reap when job terminated ( send signal SIGCHILD )</span></span>
<span class="line">                waitfg ( pid );</span>
<span class="line">            &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">                <span class="comment">//[1] (6325) ./myspin 1 &amp;</span></span>
<span class="line">                <span class="built_in">printf</span> ( <span class="string">"[%d] (%d) %s"</span>, pid2jid ( pid ), pid, cmdline );</span>
<span class="line">            &#125;</span>
<span class="line">        &#125;</span>
<span class="line">    &#125;</span>
<span class="line">    <span class="keyword">return</span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>2.int builtin_cmd( char **argv)</h3>
<ul>
<li>Four commands are to be built-in in the shell</li>
<li>quit: exit the shell.</li>
<li>jobs: List the running and stopped background jobs.</li>
</ul>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span>
<span class="line"><span class="comment"> * builtin_cmd - If the user has typed a built-in command then execute</span></span>
<span class="line"><span class="comment"> *    it immediately.</span></span>
<span class="line"><span class="comment"> */</span> </span>
<span class="line"><span class="function"><span class="keyword">int</span> <span class="title">builtin_cmd</span> <span class="params">( <span class="keyword">char</span> **argv )</span> </span>&#123;</span>
<span class="line">    <span class="keyword">if</span> ( <span class="built_in">strcmp</span> ( argv[ <span class="number">0</span> ], <span class="string">"quit"</span> ) == <span class="number">0</span> ) &#123;</span>
<span class="line">        <span class="built_in">exit</span> ( <span class="number">0</span> );</span>
<span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strcmp</span> ( argv[ <span class="number">0</span> ], <span class="string">"jobs"</span> ) == <span class="number">0</span> ) &#123;</span>
<span class="line">        listjobs ( jobs );</span>
<span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span>
<span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span> ( argv[ <span class="number">0</span> ], <span class="string">"fg"</span> ) || !<span class="built_in">strcmp</span> ( argv[ <span class="number">0</span> ], <span class="string">"bg"</span> ) ) &#123;</span>
<span class="line">        do_bgfg ( argv );</span>
<span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span>
<span class="line">    &#125;</span>
<span class="line">    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">/* not a builtin command */</span></span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>3. void waitfg( pid_t pid )</h3>
<ul>
<li>shell should wait for foreground process</li>
<li>This function should wait by sleeping for 1 second repeatedly until the specified process is no longer the foreground process (state = FG)</li>
</ul>
<p>Hints</p>
<ul>
<li>In <code>waitfg</code>, use a busy loop around the sleep function.</li>
</ul>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span>
<span class="line"><span class="comment"> * waitfg - Block until process pid is no longer the foreground process</span></span>
<span class="line"><span class="comment"> */</span></span>
<span class="line"><span class="function"><span class="keyword">void</span> <span class="title">waitfg</span> <span class="params">( <span class="keyword">pid_t</span> pid )</span> </span>&#123;</span>
<span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">job_t</span> *<span class="title">job</span> = <span class="title">getjobpid</span> ( <span class="title">jobs</span>, <span class="title">pid</span> );</span></span>
<span class="line">    <span class="keyword">if</span> ( pid == <span class="number">0</span> )</span>
<span class="line">        <span class="keyword">return</span>;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">if</span> ( job != <span class="literal">NULL</span> ) &#123;</span>
<span class="line">        <span class="comment">// sleep</span></span>
<span class="line">        <span class="keyword">while</span> ( pid == fgpid ( jobs ) ) &#123;</span>
<span class="line">        &#125;</span>
<span class="line">    &#125;</span>
<span class="line">    <span class="keyword">return</span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>4. void do_bgfg( char **argv )</h3>
<ul>
<li><code>bg &lt;job&gt;</code>: Change a <strong>stopped</strong> background job to a <strong>running</strong> <strong>background</strong> job.</li>
<li><code>fg &lt;job&gt;</code>: Change a <strong>stopped or running</strong> background job to a running in the <strong>foreground</strong>.</li>
<li>The <code>bg &lt;job&gt;</code> command restarts &lt;job&gt; by sending it a <code>SIGCONT</code>signal, and then runs it in the background. The &lt;job&gt; argument can be either a PID or a JID.</li>
</ul>
<ul>
<li>The <code>fg &lt;job&gt;</code>command restarts &lt;job&gt; by sending it a <code>SIGCONT</code>signal, and then runs it in the foreground. The &lt;job&gt; argument can be either a PID or a JID.</li>
</ul>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
<span class="line">58</span>
<span class="line">59</span>
<span class="line">60</span>
<span class="line">61</span>
<span class="line">62</span>
<span class="line">63</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span>
<span class="line"><span class="comment"> * do_bgfg - Execute the builtin bg and fg commands</span></span>
<span class="line"><span class="comment"> */</span></span>
<span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_bgfg</span> <span class="params">( <span class="keyword">char</span> **argv )</span> </span>&#123;</span>
<span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">job_t</span> *<span class="title">job</span>;</span></span>
<span class="line">    <span class="keyword">char</span> *tmp;</span>
<span class="line">    <span class="keyword">int</span> jid;</span>
<span class="line">    <span class="keyword">pid_t</span> pid;</span>
<span class="line"></span>
<span class="line">    tmp = argv[ <span class="number">1</span> ];</span>
<span class="line"></span>
<span class="line">    <span class="comment">// unvalid id</span></span>
<span class="line">    <span class="keyword">if</span> ( tmp == <span class="literal">NULL</span> ) &#123;</span>
<span class="line">        <span class="built_in">printf</span> ( <span class="string">"%s command requires PID or %%jobid argument\n"</span>, argv[ <span class="number">0</span> ] );</span>
<span class="line">        <span class="keyword">return</span>;</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="comment">// jid</span></span>
<span class="line">    <span class="keyword">if</span> ( tmp[ <span class="number">0</span> ] == <span class="string">'%'</span> ) &#123;</span>
<span class="line">        <span class="comment">// string to integer</span></span>
<span class="line">        jid = atoi ( &amp;tmp[ <span class="number">1</span> ] );</span>
<span class="line">        job = getjobjid ( jobs, jid );</span>
<span class="line"></span>
<span class="line">        <span class="comment">// unvalid jid</span></span>
<span class="line">        <span class="keyword">if</span> ( job == <span class="literal">NULL</span> ) &#123;</span>
<span class="line">            <span class="comment">//%2: No such job</span></span>
<span class="line">            <span class="built_in">printf</span> ( <span class="string">"%s: No such job\n"</span>, tmp );</span>
<span class="line">            <span class="keyword">return</span>;</span>
<span class="line">        &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">            pid = job-&gt;pid;</span>
<span class="line">        &#125;</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="comment">// pid</span></span>
<span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">isdigit</span> ( tmp[ <span class="number">0</span> ] ) ) &#123;</span>
<span class="line">        pid = atoi ( tmp );</span>
<span class="line">        job = getjobpid ( jobs, pid );</span>
<span class="line"></span>
<span class="line">        <span class="comment">// unvalid pid</span></span>
<span class="line">        <span class="keyword">if</span> ( job == <span class="literal">NULL</span> ) &#123;</span>
<span class="line">            <span class="comment">//(2): No such process</span></span>
<span class="line">            <span class="built_in">printf</span> ( <span class="string">"(%d): No such process\n"</span>, pid );</span>
<span class="line">            <span class="keyword">return</span>;</span>
<span class="line">        &#125;</span>
<span class="line">    &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">        <span class="built_in">printf</span> ( <span class="string">"%s: argument must be a PID or %%jobid\n"</span>, argv[ <span class="number">0</span> ] );</span>
<span class="line">        <span class="keyword">return</span>;</span>
<span class="line">    &#125;</span>
<span class="line">    <span class="comment">// awakened by the receipt of a SIGCONT signal.</span></span>
<span class="line">    kill ( -pid, SIGCONT );</span>
<span class="line"></span>
<span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span> ( <span class="string">"fg"</span>, argv[ <span class="number">0</span> ] ) ) &#123;</span>
<span class="line">        <span class="comment">// foreground, shell wait for it</span></span>
<span class="line">        job-&gt;state = FG;</span>
<span class="line">        waitfg ( job-&gt;pid );</span>
<span class="line">    &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">        job-&gt;state = BG;</span>
<span class="line">        <span class="comment">// print</span></span>
<span class="line">        <span class="built_in">printf</span> ( <span class="string">"[%d] (%d) %s"</span>, job-&gt;jid, job-&gt;pid, job-&gt;cmdline );</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">return</span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>5.void sigchld_handler( int sig )</h3>
<p>This is the shell's handler for the<code>SIGCHLD</code> signal.</p>
<p>Hints</p>
<ul>
<li>In <code>sigchld_handler</code>, use exactly one call to <code>waitpid</code></li>
</ul>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
</pre></td><td class="code"><pre><span class="line"></span>
<span class="line"><span class="comment">/*</span></span>
<span class="line"><span class="comment"> * sigchld_handler - The kernel sends a SIGCHLD to the shell whenever</span></span>
<span class="line"><span class="comment"> *     a child job terminates (becomes a zombie), or stops because it</span></span>
<span class="line"><span class="comment"> *     received a SIGSTOP or SIGTSTP signal. The handler reaps all</span></span>
<span class="line"><span class="comment"> *     available zombie children, but doesn't wait for any other</span></span>
<span class="line"><span class="comment"> *     currently running children to terminate.</span></span>
<span class="line"><span class="comment"> */</span></span>
<span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sigchld_handler</span> <span class="params">( <span class="keyword">int</span> sig )</span> </span>&#123;</span>
<span class="line">    <span class="keyword">pid_t</span> pid;</span>
<span class="line">    <span class="keyword">int</span> status;</span>
<span class="line"></span>
<span class="line">    <span class="comment">// wait for all child to end</span></span>
<span class="line">    <span class="keyword">while</span> ( ( pid = waitpid ( <span class="number">-1</span>, &amp;status, WNOHANG | WUNTRACED ) ) &gt; <span class="number">0</span> ) &#123;</span>
<span class="line">        <span class="comment">// child currently stopped</span></span>
<span class="line">        <span class="keyword">if</span> ( WIFSTOPPED ( status ) ) &#123;</span>
<span class="line">            <span class="comment">// change state</span></span>
<span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">job_t</span> *<span class="title">job</span> = <span class="title">getjobpid</span> ( <span class="title">jobs</span>, <span class="title">pid</span> );</span></span>
<span class="line">            job-&gt;state = ST;</span>
<span class="line"></span>
<span class="line">            <span class="keyword">int</span> jid = pid2jid ( pid );</span>
<span class="line">            <span class="comment">// Job [2] (14171) stopped by signal 20</span></span>
<span class="line">            <span class="built_in">printf</span> ( <span class="string">"Job [%d] (%d) stopped by signal %d\n"</span>, jid, pid, WSTOPSIG ( status ) );</span>
<span class="line"></span>
<span class="line">        &#125;</span>
<span class="line">        <span class="comment">// child terminated because of a signal</span></span>
<span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( WIFSIGNALED ( status ) ) &#123;</span>
<span class="line">            <span class="keyword">int</span> jid = pid2jid ( pid );</span>
<span class="line">            <span class="comment">// INT</span></span>
<span class="line">            <span class="comment">// Job [1] (13253) terminated by signal 2</span></span>
<span class="line">            <span class="built_in">printf</span> ( <span class="string">"Job [%d] (%d) terminated by signal %d\n"</span>, jid, pid, WTERMSIG ( status ) );</span>
<span class="line">            deletejob ( jobs, pid );</span>
<span class="line">        &#125;</span>
<span class="line">        <span class="comment">// child terminated normally</span></span>
<span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( WIFEXITED ( status ) ) &#123;</span>
<span class="line">            deletejob ( jobs, pid );</span>
<span class="line">        &#125;</span>
<span class="line">    &#125;</span>
<span class="line">    <span class="keyword">return</span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>6. void sigint_handler ( int sig )</h3>
<p>Hints</p>
<ul>
<li>When you implement your signal handlers, be sure to send <code>SIGINT</code> and <code>SIGTSTP</code> signals to the entire foreground process group, using <code>-pid</code> instead of <code>pid</code> in the argument to the kill function.
The <code>sdriver.pl</code> program tests for this error.</li>
</ul>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span>
<span class="line"><span class="comment"> * sigint_handler - The kernel sends a SIGINT to the shell whenver the</span></span>
<span class="line"><span class="comment"> *    user types ctrl-c at the keyboard.  Catch it and send it along</span></span>
<span class="line"><span class="comment"> *    to the foreground job.</span></span>
<span class="line"><span class="comment"> */</span></span>
<span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sigint_handler</span> <span class="params">( <span class="keyword">int</span> sig )</span> </span>&#123;</span>
<span class="line">    <span class="keyword">pid_t</span> pid = fgpid ( jobs );</span>
<span class="line"></span>
<span class="line">    <span class="keyword">if</span> ( pid != <span class="number">0</span> ) &#123;</span>
<span class="line">        kill ( -pid, sig );</span>
<span class="line">    &#125;</span>
<span class="line">    <span class="keyword">return</span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>7.void sigtstp_handler ( int sig )</h3>
<p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span>
<span class="line"><span class="comment"> * sigtstp_handler - The kernel sends a SIGTSTP to the shell whenever</span></span>
<span class="line"><span class="comment"> *     the user types ctrl-z at the keyboard. Catch it and suspend the</span></span>
<span class="line"><span class="comment"> *     foreground job by sending it a SIGTSTP.</span></span>
<span class="line"><span class="comment"> */</span></span>
<span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sigtstp_handler</span> <span class="params">( <span class="keyword">int</span> sig )</span> </span>&#123;</span>
<span class="line">    <span class="keyword">pid_t</span> pid = fgpid ( jobs );</span>
<span class="line"></span>
<span class="line">    <span class="keyword">if</span> ( pid != <span class="number">0</span> ) &#123;</span>
<span class="line">        kill ( -pid, sig );</span>
<span class="line">    &#125;</span>
<span class="line">    <span class="keyword">return</span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/10/SICP/sicp2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/10/SICP/sicp2/" itemprop="url">[SICP-ch2] Building Abstractions with Data</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-10T09:46:51+08:00">
                2018-03-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SICP/" itemprop="url" rel="index">
                    <span itemprop="name">SICP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/10/SICP/sicp2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/03/10/SICP/sicp2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>SICP-ch2 Building Abstractions with Data</h2>
<p>building abstractions by forming compound data</p>
<p>&lt;br/&gt;</p>
<p>Intro</p>
<ul>
<li>2.1 data abstraction erect abstraction barriers</li>
<li>2.2 data == procedures, sequences, closure, conventional interface</li>
<li>2.3  symbols as elementary data</li>
<li>2.4  generic operations, data directed programming, additivity</li>
<li>2.5 implement a package</li>
</ul>
<p>&lt;br/&gt;</p>
<p>&lt;!-- more --&gt;</p>
<h3>2.1 Introduction to Data Abstraction</h3>
<p><strong>Data abstraction</strong></p>
<ul>
<li>isolating</li>
<li>( the parts of a program that deal with how data objects are <strong>represented</strong> )</li>
<li>from</li>
<li>( the parts of a program that deal with how data objects are <strong>used</strong> )</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Construct abstract data</p>
<ul>
<li>use constructors, selectors as interface</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>2.1.1 Example: Arithmetic Operations for Rational Numbers</strong></p>
<ol>
<li>assume the constructor and selectors are available</li>
</ol>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">numer , denom , make-rat</span>
</pre></td></tr></table></figure></p>
<ol start="2">
<li>use them to express rational operation</li>
</ol>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">add-rat</span> x y)</span>
<span class="line">	(<span class="name">make-rat</span> (<span class="name"><span class="builtin-name">+</span></span> (<span class="name"><span class="builtin-name">*</span></span> (<span class="name">numer</span> x) (<span class="name">denom</span> y))</span>
<span class="line">		(<span class="name"><span class="builtin-name">*</span></span> (<span class="name">numer</span> y) (<span class="name">denom</span> x)))</span>
<span class="line">		(<span class="name"><span class="builtin-name">*</span></span> (<span class="name">denom</span> x) (<span class="name">denom</span> y))))</span>
</pre></td></tr></table></figure></p>
<ol start="3">
<li>implement representation</li>
</ol>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">make-rat</span> n d) (<span class="name"><span class="builtin-name">cons</span></span> n d))</span>
<span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">numer</span> x) (<span class="name"><span class="builtin-name">car</span></span> x))</span>
<span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">denom</span> x) (<span class="name"><span class="builtin-name">cdr</span></span> x))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>2.1.2 Abstraction Barriers</strong></p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1520647179/Screenshot_from_2018-03-10_09-58-22.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p><strong>2.1.3 What Is Meant by Data?</strong></p>
<p>DEF:</p>
<ol>
<li>some collection of selectors and constructors</li>
<li>together with specified conditions for the representation</li>
</ol>
<p>&lt;br/&gt;</p>
<p>Example</p>
<ul>
<li>Pairs z = ( x, y )</li>
</ul>
<ul>
<li>selector: car, cdr</li>
<li>constructor: cons</li>
<li>condition: if z = ( x, y ) =&gt; ( car z ) = x &amp;&amp; ( cdr z ) = y</li>
</ul>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name"><span class="builtin-name">cons</span></span> x y)</span>
<span class="line">	(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">dispatch</span> m)</span>
<span class="line">		(<span class="name"><span class="builtin-name">cond</span></span> ((<span class="name"><span class="builtin-name">=</span></span> m <span class="number">0</span>) x)</span>
<span class="line">			 ((<span class="name"><span class="builtin-name">=</span></span> m <span class="number">1</span>) y)</span>
<span class="line">		     (<span class="name"><span class="builtin-name">else</span></span> (<span class="name">error</span> <span class="string">"Argument not 0 or 1: CONS"</span> m))))</span>
<span class="line">	<span class="comment">;message passing: data representation returns procedure</span></span>
<span class="line">    dispatch)</span>
<span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name"><span class="builtin-name">car</span></span> z) (<span class="name">z</span> <span class="number">0</span>))</span>
<span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name"><span class="builtin-name">cdr</span></span> z) (<span class="name">z</span> <span class="number">1</span>))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Exercise 2.6</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">;2.6</span></span>
<span class="line"><span class="comment">;church numerals DEF</span></span>
<span class="line">( define zero ( lambda ( f ) ( lambda ( x ) x ) ) )</span>
<span class="line"></span>
<span class="line">( define ( add-1 n )</span>
<span class="line">         ( lambda ( f )( lambda ( x ) ( f ( ( n f ) x ) ))))</span>
<span class="line"></span>
<span class="line"><span class="comment">;从0开始，每多一个f就+1</span></span>
<span class="line">( define ( church-to-int ch )</span>
<span class="line">         ( ( ch ( lambda ( n ) ( + n <span class="number">1</span> ) ) ) <span class="number">0</span> ) )</span>
<span class="line"></span>
<span class="line">( define one ( lambda ( f ) ( lambda ( x ) ( f x ) ) ) )</span>
<span class="line"></span>
<span class="line">( define two ( lambda ( f ) ( lambda ( x ) ( f ( f x ) ) ) ) )</span>
<span class="line"></span>
<span class="line"><span class="comment">;a,b: function of zero, one, two...</span></span>
<span class="line"><span class="comment">;b以x为参数经过b次apply f</span></span>
<span class="line"><span class="comment">;a以x经过b次apply后的结果为参数(( b f ) x )，在此基础上再apply f a次</span></span>
<span class="line">( define ( add a b )</span>
<span class="line">         ( lambda ( f )</span>
<span class="line">                  ( lambda ( x ) ( ( a f ) ( ( b f ) x ) ) ) ) )</span>
<span class="line"></span>
<span class="line"><span class="comment">;调用</span></span>
<span class="line">( define ( square x )</span>
<span class="line">         ( * x x ))</span>
<span class="line"></span>
<span class="line"><span class="comment">; f = square x = 2 </span></span>
<span class="line">( ( two square ) <span class="number">2</span> )</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>2.2 Hierarchical Data and the Closure Property</h3>
<p><strong>closure property</strong> of cons ( an operation )</p>
<ul>
<li>The ability to create pairs whose elements are pairs</li>
<li>Closure is the key to create hierarchical structures</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>2.2.1 Representing Sequences</strong></p>
<p>The entire sequence is constructed by nested cons operations</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line">(cons 1</span>
<span class="line">	(cons 2</span>
<span class="line">		(cons 3</span>
<span class="line">			(cons 4 nil))))</span>
</pre></td></tr></table></figure></p>
<p>Provides a primitive</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">list</span></span> ⟨ a <span class="number">1</span> ⟩ ⟨ a <span class="number">2</span> ⟩ . . . ⟨ a n ⟩ )</span>
</pre></td></tr></table></figure></p>
<p>Operations</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">ref, length, append, last-pair, reverse</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>Mapping over list</strong></p>
<ul>
<li>Establish an abstraction barrier that</li>
<li>isolates</li>
<li>the implementation of procedures that transform lists</li>
<li>from</li>
<li>the details of how the elements of the list are extracted and combined.</li>
</ul>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name"><span class="builtin-name">map</span></span> proc items)</span>
<span class="line">	(<span class="name"><span class="builtin-name">if</span></span> (<span class="name"><span class="builtin-name">null?</span></span> items)</span>
<span class="line">	nil</span>
<span class="line">	(<span class="name"><span class="builtin-name">cons</span></span> (<span class="name">proc</span> (<span class="name"><span class="builtin-name">car</span></span> items))</span>
<span class="line">		  (<span class="name"><span class="builtin-name">map</span></span> proc (<span class="name"><span class="builtin-name">cdr</span></span> items)))))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>2.2.2 Hierarchical Structures</strong></p>
<p>Tree</p>
<ul>
<li>sequences whose elements are sequences</li>
<li>Recursion is a natural tool for dealing with tree structures</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>2.2.3 Sequences as Conventional Interfaces</strong></p>
<p>Conventional Interface</p>
<ul>
<li>permits us to combine processing modules</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Signal Processing</strong></p>
<blockquote>
<p>A signal-processing engineer would find it natural to conceptualize these processes in terms of signals flowing through a cascade of stages, each of which implements part of the program plan.</p>
</blockquote>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1520647409/Screenshot_from_2018-03-10_10-03-03.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p><strong>Organizing programs so as to reflect the signal-flow structure</strong></p>
<ul>
<li>concentrate on the “signals”</li>
<li>represent these signals as <strong>lists</strong></li>
<li>use list operations to implement the processing</li>
<li>helps us make program designs that are modular</li>
<li>connecting the components in flexible ways</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Nested Mappings</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">flatmap</span> proc seq)</span>
<span class="line">	(<span class="name">accumulate</span> append nil (<span class="name"><span class="builtin-name">map</span></span> proc seq)))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>2.3 Symbolic Data</h3>
<p>Issue arise</p>
<ul>
<li>words and sentences may be regarded either as <strong>semantic</strong> entities ( meaning ) or as <strong>syntactic</strong> entities ( characters )</li>
</ul>
<p>Using quotation mark</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">list</span></span> <span class="symbol">'a</span> <span class="symbol">'b</span>)</span>
<span class="line">(<span class="name">a</span> b)</span>
</pre></td></tr></table></figure></p>
<p>manipulating symbols</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">eq?, memq</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>2.4 Multiple Representations for Abstract Data</h3>
<p>cope with data that may be represented in different ways by different parts of a program</p>
<p><strong>Data Abstraction</strong></p>
<ul>
<li><strong>separate</strong> the task of designing a program that <strong>uses</strong> rational numbers from the task of <strong>implementing</strong> rational numbers</li>
<li>an application of the &quot;principle of least commitment&quot;</li>
</ul>
<p><strong>Abstraction Barrier</strong></p>
<ul>
<li>formed by the selectors and constructors</li>
<li>permits us to defer to the last possible moment the choice of a concrete representation</li>
<li>thus retain maximum flexibility</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>2.4.1 Representations for Complex Numbers</strong></p>
<p>constructors</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">make-from-real-imag</span> (<span class="name"><span class="builtin-name">real-part</span></span> z) (<span class="name"><span class="builtin-name">imag-part</span></span> z))</span>
<span class="line">(<span class="name">make-from-mag-ang</span> (<span class="name"><span class="builtin-name">magnitude</span></span> z) (<span class="name"><span class="builtin-name">angle</span></span> z))</span>
</pre></td></tr></table></figure></p>
<p>selectors</p>
<p>rectangular representation &amp; polar representation</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">real-part,imag-part,magnitude,angle</span>
</pre></td></tr></table></figure></p>
<p>implement arithmetic on complex numbers</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">add-complex, sub-complex, mul-complex, div-complex</span>
</pre></td></tr></table></figure></p>
<p>implement 2 representations of complex number</p>
<p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">分别用直角和极坐标来实现<span class="number">4</span>个<span class="keyword">selector</span>和<span class="number">2</span>个<span class="function"><span class="keyword">constructor</span></span></span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>2.4.2 Tagged data</strong></p>
<p>If <strong>both</strong> representations are included in a single system, we will need some way to <strong>distinguish</strong> data in polar form from data in rectangular form.</p>
<p>A straightforward way to accomplish this distinction is to include a <strong>type tag</strong> —the symbol rectangular or polar —as part of each complex number.</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">make-from-real-imag-rectangular</span> x y)</span>
<span class="line">	(<span class="name">attach-tag</span> <span class="symbol">'rectangular</span> (<span class="name"><span class="builtin-name">cons</span></span> x y)))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Make sure <strong>names</strong> do not conflict: Append the suffix -rectangular</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">real-part-rectangular</span> z) (<span class="name"><span class="builtin-name">car</span></span> z))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Generic selector</p>
<ul>
<li>Dispatch: checks the tag and calls the appropriate procedure of that type.</li>
<li>because the selectors are generic, operation ( add, mul ) are unchanged</li>
</ul>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name"><span class="builtin-name">real-part</span></span> z)</span>
<span class="line">	(<span class="name"><span class="builtin-name">cond</span></span> ((<span class="name">rectangular?</span> z)</span>
<span class="line">		  (<span class="name">real-part-rectangular</span> (<span class="name">contents</span> z)))</span>
<span class="line">		 ((<span class="name">polar?</span> z)</span>
<span class="line">		  (<span class="name">real-part-polar</span> (<span class="name">contents</span> z)))</span>
<span class="line">		 (<span class="name"><span class="builtin-name">else</span></span> (<span class="name">error</span> <span class="string">"Unknown type: REAL-PART"</span> z))))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Generic Constructor</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">make-from-real-imag</span> x y)</span>
<span class="line">	(<span class="name">make-from-real-imag-rectangular</span> x y))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>General mechanism</strong> for interfacing the separate representations</p>
<ul>
<li>stripping off and attaching tags as data objects are passed from level to level</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>2.4.3 Data-Directed Programming and Additivity</strong></p>
<p>Two weaknesses of dispatching above</p>
<ul>
<li>generic interface procedures must know about <strong>all</strong> the different representations</li>
<li>must guarantee that no two procedures in the entire system have the same <strong>name</strong></li>
</ul>
<p>&lt;br/&gt;</p>
<p>Additive</p>
<ul>
<li>design the individual packages separately and</li>
<li>combine them to produce a generic system</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Data-directed programming</strong></p>
<ul>
<li>dealing with a two-dimensional table</li>
<li>the possible operations on one axis and the possible types on the other axisss</li>
</ul>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1520647610/Screenshot_from_2018-03-10_10-06-28.png" alt=""></p>
<p>&lt;br/&gt;</p>
<p>Manipulate table</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">put</span> ⟨ op ⟩ ⟨ type ⟩ ⟨ item ⟩ )</span>
<span class="line">(<span class="name">get</span> ⟨ op ⟩ ⟨ type ⟩ )</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Defines a package</p>
<p>Interfaces these by adding entries to the table</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">install-rectangular-package</span>)</span>
<span class="line">	<span class="comment">;; internal procedures</span></span>
<span class="line">	(<span class="name"><span class="builtin-name">define</span></span> (<span class="name"><span class="builtin-name">real-part</span></span> z) (<span class="name"><span class="builtin-name">car</span></span> z))</span>
<span class="line">	(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">make-from-real-imag</span> x y) (<span class="name"><span class="builtin-name">cons</span></span> x y))</span>
<span class="line">		</span>
<span class="line">	<span class="comment">;; interface to the rest of the system</span></span>
<span class="line">	(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">tag</span> x) (<span class="name">attach-tag</span> <span class="symbol">'rectangular</span> x))</span>
<span class="line">	(<span class="name">put</span> <span class="symbol">'real-part</span> '(rectangular) real-part)</span>
<span class="line">  	(<span class="name">put</span> <span class="symbol">'make-from-real-imag</span> <span class="symbol">'rectangular</span></span>
<span class="line">		(<span class="name"><span class="builtin-name">lambda</span></span> (x y) (<span class="name">tag</span> (<span class="name">make-from-real-imag</span> x y))))</span>
<span class="line"></span>
<span class="line">	<span class="symbol">'done</span>)</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Generic Selectors</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">apply-generic</span> op . args)</span>
<span class="line">	(<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">type-tags</span> (<span class="name"><span class="builtin-name">map</span></span> type-tag args)))</span>
<span class="line">		(<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">proc</span> (<span class="name">get</span> op type-tags)))</span>
<span class="line">			(<span class="name"><span class="builtin-name">if</span></span> proc</span>
<span class="line">                  <span class="comment">;apply arguments to procedure</span></span>
<span class="line">				(<span class="name"><span class="builtin-name">apply</span></span> proc (<span class="name"><span class="builtin-name">map</span></span> contents args))</span>
<span class="line">				(<span class="name">error</span></span>
<span class="line">					<span class="string">"No method for these types: APPLY-GENERIC"</span></span>
<span class="line">					(<span class="name"><span class="builtin-name">list</span></span> op type-tags))))))</span>
</pre></td></tr></table></figure></p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name"><span class="builtin-name">real-part</span></span> z) (<span class="name">apply-generic</span> <span class="symbol">'real-part</span> z))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Generic Constructors</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">make-from-real-imag</span> x y)</span>
<span class="line">	((<span class="name">get</span> <span class="symbol">'make-from-real-imag</span> <span class="symbol">'rectangular</span>) x y))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Interface ( generic selectors )</p>
<table>
<thead>
<tr>
<th style="text-align:center">Previous</th>
<th style="text-align:center">Data-directed</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">a set of procedures</td>
<td style="text-align:center">single procedure</td>
</tr>
<tr>
<td style="text-align:center">explicit dispatch</td>
<td style="text-align:center">looks up</td>
</tr>
<tr>
<td style="text-align:center">name conflicts</td>
<td style="text-align:center">internal</td>
</tr>
<tr>
<td style="text-align:center">change if a new representation is added</td>
<td style="text-align:center">doesn't change</td>
</tr>
<tr>
<td style="text-align:center">Centralized selectors</td>
<td style="text-align:center">Decentralized</td>
</tr>
</tbody>
</table>
<p>&lt;br/&gt;</p>
<p><strong>Message passing</strong></p>
<p>Data object receives the requested operation name as a “message.”</p>
<p>&lt;br/&gt;</p>
<p>Instead of using “intelligent operations” that dispatch on data types</p>
<p>work with “intelligent data objects” that dispatch on <strong>operation names</strong>.</p>
<p>&lt;br/&gt;</p>
<p>Represent <strong>data object</strong> as a <strong>procedure</strong></p>
<ul>
<li>takes as input the required operation name</li>
<li>performs the operation indicated</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Constructor</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">make-from-real-imag</span> x y)</span>
<span class="line">	(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">dispatch</span> op)</span>
<span class="line">		(<span class="name"><span class="builtin-name">cond</span></span> ((<span class="name"><span class="builtin-name">eq?</span></span> op <span class="symbol">'real-part</span>) x)</span>
<span class="line">			  (<span class="name"><span class="builtin-name">else</span></span> (<span class="name">error</span> <span class="string">"Unknown op: MAKE-FROM-REAL-IMAG"</span> op))))</span>
<span class="line">	<span class="comment">;return procedure</span></span>
<span class="line">	dispatch)</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Selector</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">apply-generic</span> op arg) (<span class="name">arg</span> op))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<h3>2.5 Systems with Generic Operations</h3>
<p>use data-directed techniques to construct a package of arithmetic operations</p>
<p><img src="http://res.cloudinary.com/dsmx9qa2z/image/upload/v1520647179/Screenshot_from_2018-03-10_09-58-59.png" alt=""></p>
<p><strong>2.5.1 Generic Arithmetic Operations</strong></p>
<p>generic arithmetic procedures</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">add</span> x y) (<span class="name">apply-generic</span> <span class="symbol">'add</span> x y))</span>
</pre></td></tr></table></figure></p>
<p>install packages</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">install-complex-package</span>)</span>
<span class="line">	<span class="comment">;; imported procedures from rectangular and polar packages</span></span>
<span class="line">	(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">make-from-real-imag</span> x y)</span>
<span class="line">		((<span class="name">get</span> <span class="symbol">'make-from-real-imag</span> <span class="symbol">'rectangular</span>) x y))</span>
<span class="line">    <span class="comment">;; internal procedures</span></span>
<span class="line">	(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">add-complex</span> z1 z2)</span>
<span class="line">		(<span class="name">make-from-real-imag</span> (<span class="name"><span class="builtin-name">+</span></span> (<span class="name"><span class="builtin-name">real-part</span></span> z1) (<span class="name"><span class="builtin-name">real-part</span></span> z2))</span>
<span class="line">						   (<span class="name"><span class="builtin-name">+</span></span> (<span class="name"><span class="builtin-name">imag-part</span></span> z1) (<span class="name"><span class="builtin-name">imag-part</span></span> z2))))</span>
<span class="line">    <span class="comment">;; interface to rest of the system</span></span>
<span class="line">	(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">tag</span> z) (<span class="name">attach-tag</span> <span class="symbol">'complex</span> z))</span>
<span class="line">  	(<span class="name">put</span> <span class="symbol">'make-from-real-imag</span> <span class="symbol">'complex</span></span>
<span class="line">		(<span class="name"><span class="builtin-name">lambda</span></span> (x y) (<span class="name">tag</span> (<span class="name">make-from-real-imag</span> x y))))</span>
<span class="line">    <span class="symbol">'done</span>)</span>
</pre></td></tr></table></figure></p>
<p>constructor</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">make-complex-from-real-imag</span> x y)</span>
<span class="line">	((<span class="name">get</span> <span class="symbol">'make-from-real-imag</span> <span class="symbol">'complex</span>) x y))</span>
</pre></td></tr></table></figure></p>
<p>two-level tag system</p>
<p>&lt;br/&gt;</p>
<p><strong>2.5.3 Example: Symbolic Algebra</strong></p>
<p>implement polynomial package</p>
<ol>
<li>arithmetic on polynomials</li>
<li>representation of polynomials</li>
<li>arithmetic on term list</li>
<li>representation of term list</li>
</ol>
<p><strong>Data Directed Recursion</strong></p>
<ul>
<li>using generic operation ( ADD ) inside each package</li>
</ul>
<p>Hierarchy of types in symbolic data</p>
<ul>
<li>recursive data abstraction</li>
<li>neither of these types is above the other naturally</li>
<li>difficult to control coercion</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>2.5.2 Combining Data of Different Types</strong></p>
<p>Define cross-type operations</p>
<p>&lt;br/&gt;</p>
<p>One way: design a different procedure for each possible combination of types</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">;; to be included in the complex package</span></span>
<span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">add-complex-to-schemenum</span> z x)</span>
<span class="line">	(<span class="name">make-from-real-imag</span> (<span class="name"><span class="builtin-name">+</span></span> (<span class="name"><span class="builtin-name">real-part</span></span> z) x) (<span class="name"><span class="builtin-name">imag-part</span></span> z)))</span>
<span class="line">(<span class="name">put</span> <span class="symbol">'add</span> '(complex scheme-number)</span>
<span class="line">	(<span class="name"><span class="builtin-name">lambda</span></span> (z x) (<span class="name">tag</span> (<span class="name">add-complex-to-schemenum</span> z x))))</span>
</pre></td></tr></table></figure></p>
<p>Cumbersome</p>
<ul>
<li>more code is needed</li>
<li>individual packages need to take account of other packages ( not additive )</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Coercion</strong></p>
<ul>
<li>objects of one type may be viewed as being of another type</li>
</ul>
<p>coercion procedure</p>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">scheme-number-&gt;complex</span> n)</span>
<span class="line">	(<span class="name">make-complex-from-real-imag</span> (<span class="name">contents</span> n) <span class="number">0</span>))</span>
</pre></td></tr></table></figure></p>
<p>install in coercion table</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">put-coercion</span> 'scheme-number</span>
<span class="line">			 'complex</span>
<span class="line">			  scheme-number-&gt;complex)</span>
</pre></td></tr></table></figure></p>
<p>apply-generic</p>
<ul>
<li>check the coercion table to see</li>
<li>if objects of the first type can be coerced to the second type or</li>
<li>if there is a way to coerce the second argument to the type of the first argument</li>
</ul>
<p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">apply-generic</span> op . args)</span>
<span class="line">	(<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">type-tags</span> (<span class="name"><span class="builtin-name">map</span></span> type-tag args)))</span>
<span class="line">		(<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">proc</span> (<span class="name">get</span> op type-tags)))</span>
<span class="line">			</span>
<span class="line">			(<span class="name"><span class="builtin-name">if</span></span> proc</span>
<span class="line">				(<span class="name"><span class="builtin-name">apply</span></span> proc (<span class="name"><span class="builtin-name">map</span></span> contents args))</span>
<span class="line">				</span>
<span class="line">				(<span class="name"><span class="builtin-name">if</span></span> (<span class="name"><span class="builtin-name">=</span></span> (<span class="name"><span class="builtin-name">length</span></span> args) <span class="number">2</span>)</span>
<span class="line">					(<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">type1</span> (<span class="name"><span class="builtin-name">car</span></span> type-tags))</span>
<span class="line">						  (<span class="name">type2</span> (<span class="name"><span class="builtin-name">cadr</span></span> type-tags))</span>
<span class="line">					       (<span class="name">a1</span> (<span class="name"><span class="builtin-name">car</span></span> args))</span>
<span class="line">						   (<span class="name">a2</span> (<span class="name"><span class="builtin-name">cadr</span></span> args)))</span>
<span class="line">						(<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">t1-&gt;t2</span> (<span class="name">get-coercion</span> type1 type2))</span>
<span class="line">							  (<span class="name">t2-&gt;t1</span> (<span class="name">get-coercion</span> type2 type1)))</span>
<span class="line">							(<span class="name"><span class="builtin-name">cond</span></span> (<span class="name">t1-&gt;t2</span></span>
<span class="line">								     (<span class="name">apply-generic</span> op (<span class="name">t1-&gt;t2</span> a1) a2))</span>
<span class="line">								 (<span class="name">t2-&gt;t1</span></span>
<span class="line">									(<span class="name">apply-generic</span> op a1 (<span class="name">t2-&gt;t1</span> a2)))</span>
<span class="line">								 (<span class="name"><span class="builtin-name">else</span></span> (<span class="name">error</span> <span class="string">"No method for these types"</span></span>
<span class="line">										(<span class="name"><span class="builtin-name">list</span></span> op type-tags))))))</span>
<span class="line">						(<span class="name">error</span> <span class="string">"No method for these types"</span></span>
<span class="line">								(<span class="name"><span class="builtin-name">list</span></span> op type-tags)))))))</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>Advantage</p>
<ul>
<li>need to write only one procedure for each pair of types rather than a different procedure for each collection of types and each generic operation.</li>
</ul>
<p>Not General Enough</p>
<ul>
<li>can't converting both objects to a third type.</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Hierarchies of types</strong></p>
<p>apply-generic</p>
<ul>
<li>raise the object to its super type</li>
<li>until we either find a level at which the desired operation can be performed</li>
<li>or hit the top</li>
</ul>
<p>Inadequates</p>
<ul>
<li>multiple-supertypes</li>
<li>means that there is no unique way to “raise” a type in the hierarchy</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/28/SICP/sicp1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/28/SICP/sicp1/" itemprop="url">[SICP-ch1] Building Abstractions with Procedures</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-28T21:52:51+08:00">
                2018-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SICP/" itemprop="url" rel="index">
                    <span itemprop="name">SICP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/28/SICP/sicp1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/02/28/SICP/sicp1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>SICP ch-1 Building Abstractions with Procedures</h2>
<p>We are about to study the idea of computational process</p>
<p>&lt;br/&gt;</p>
<h3>1.1 The Elements of Programming</h3>
<p>Language combine simple ideas to form complex ideas by three mechanisms</p>
<ol>
<li>primitive expression</li>
<li>means of combination</li>
<li>means of abstraction</li>
</ol>
<p>&lt;br/&gt;</p>
<p>&lt;!-- more --&gt;</p>
<p><strong>1.1.1 Expressions</strong></p>
<ul>
<li>you type an expression, the <strong>interpreter</strong> responds by displaying the result of its <strong>evaluating</strong> that expression ( 486 )</li>
</ul>
<p>Combinations</p>
<ul>
<li>Expressions formed by delimiting a list of expressions within parentheses ( + 137 349 )</li>
<li>operator, operands</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>1.1.2 Naming and the Environment</strong></p>
<p>Naming</p>
<ul>
<li>language provides the means of using names ( variable ) to refer to computational objects ( value )</li>
<li>Associating values with symbols</li>
</ul>
<p><strong>Environment</strong></p>
<ul>
<li>The <strong>memory</strong> that interpreter must maintain to <strong>keeps track</strong> of the name-object pairs.  ( ch-3 )</li>
<li>Determine the meaning of the symbols in expressions.</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>1.1.3 Evaluating Combinations</strong></p>
<p>Interpreter is itself following a procedure</p>
<ol>
<li><strong>Evaluate</strong> the <strong>subexpressions</strong> of the combination</li>
<li><strong>Apply</strong> the procedure that is the value of the leftmost <strong>subexpression</strong> (the operator) to the arguments that are the values of the other <strong>subexpressions</strong> (the operands).</li>
</ol>
<p>Thus, the evaluation rule is <strong>recursive</strong> in nature.</p>
<p>&lt;br/&gt;</p>
<p><strong>Special Forms</strong></p>
<ul>
<li>Exceptions to the general evaluation rule. ( apply operator to operands )</li>
<li>Each special form has its own evaluation rule.</li>
<li>define, cond, if, and, or,</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>1.1.4 Compound Procedures</strong></p>
<p>Procedure definitions</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">define</span> (<span class="name">&lt;name&gt;</span> &lt;formal parameters&gt;)</span>
<span class="line">  &lt;body&gt;)</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>1.1.5 The Substitution Model for Procedure Application</strong></p>
<p>Evaluate a combination</p>
<ul>
<li>evaluates the elements of the combination</li>
<li>applies the procedure to the arguments</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>Substitution Model</strong></p>
<ul>
<li>To <strong>apply</strong> a compound procedure to arguments, <strong>evaluate</strong> the body of he procedure with each formal parameter <strong>replaced</strong> by the corresponding argument.</li>
<li>Typical interpreters <strong>do not</strong> evaluate procedure by substitute values, but using a <strong>local environment</strong> for the formal parameters ( ch-3 )</li>
<li>This model breaks down when we address procedures with &quot;mutable data&quot; ( ch-3 set! )</li>
</ul>
<p>&lt;br/&gt;</p>
<p>Normal Order</p>
<p>fully expand and then reduce (x)</p>
<p><strong>Applicative Order</strong></p>
<p>evaluate the arguments and then apply</p>
<p>&lt;br/&gt;</p>
<p><strong>1.1.6 Conditional Expressions and Predicates</strong></p>
<p><strong>Predicate</strong></p>
<ul>
<li>an expression whose value is interpreted as either true or false.</li>
</ul>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">cond</span> (<span class="name">&lt;p1&gt;</span> &lt;e1&gt;)</span>
<span class="line">      (<span class="name">&lt;p2&gt;</span> &lt;e2&gt;)</span>
<span class="line">      ...</span>
<span class="line">      (<span class="name">&lt;pn&gt;</span> &lt;en&gt;))</span>
<span class="line"></span>
<span class="line">(<span class="name">if</span> &lt;predicate&gt;</span>
<span class="line">    &lt;consequent&gt;</span>
<span class="line">    &lt;alternative&gt;)</span>
<span class="line"></span>
<span class="line">(<span class="name">and</span> &lt;e1&gt; ... &lt;en&gt;)</span>
<span class="line">(<span class="name">or</span> &lt;e1&gt; ... &lt;en&gt;)</span>
<span class="line">(<span class="name">not</span> &lt;e&gt;)</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>1.1.7 Example: Square Roots by Newton’s Method</strong></p>
<p><strong>1.1.8 Procedures are Black-Box Abstractions</strong></p>
<p>bound variables</p>
<ul>
<li>In procedure definition, it doesn't matter what name the formal parameter has.</li>
</ul>
<p>free variables</p>
<p>the scope of that name</p>
<p>&lt;br/&gt;</p>
<h3>1.2 Procedures and the Processes They Generate</h3>
<p><strong>Procedure</strong></p>
<ul>
<li>A <strong>procedure</strong> is a pattern for the local evolution of a computational <strong>process</strong>.</li>
<li>It specifies how each stage of the process is built upon the previous stage.</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>1.2.1 Linear Recursion and Iteration</strong></p>
<p>Recursive procedure</p>
<ul>
<li>syntactic fact that the procedure definition refers to the procedure itself</li>
</ul>
<p>Recursive <strong>process</strong></p>
<ul>
<li>The process that characterized by a chain of <strong>deferred</strong> operations</li>
<li>Requires <strong>interpreter</strong> keep track of operations to be performed later on.</li>
</ul>
<p>Iterative process</p>
<ul>
<li>one whose state can be summarized by a fixed number of <strong>state variables</strong>, together with a fixed rule that describes how the state variables should be <strong>updated</strong> as the process moves from state to state and an (optional) end test.</li>
</ul>
<p><strong>Tail Recursive</strong></p>
<ul>
<li>An implementation with the property of:  &quot;An iterative process will be executed in <strong>constant space</strong>, even if it is described by a recursive procedure.&quot;</li>
</ul>
<p>&lt;br/&gt;</p>
<h3>1.3 Formulating Abstractions with Higher-Order Procedures</h3>
<p>Procedures are <strong>abstractions</strong> that describe compound operations</p>
<p>Higher-order procedures</p>
<ul>
<li>procedures that manipulate procedures</li>
</ul>
<p>&lt;br/&gt;</p>
<p><strong>1.3.1 Procedures as Arguments</strong></p>
<p><strong>1.3.2 Constructing Procedures Using lambda</strong></p>
<p>In general, lambda is used to create procedures in the same way as
define , except that <strong>no name</strong> is specified for the procedure</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">(lambda (&lt;formal parameters&gt;)</span>
<span class="line">  &lt;body&gt;)</span>
</pre></td></tr></table></figure></p>
<p>using lambda creating local variables</p>
<p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line">(<span class="name">let</span> ((<span class="name">&lt;var1&gt;</span> &lt;exp1&gt;)</span>
<span class="line">      (<span class="name">&lt;var2&gt;</span> &lt;exp2&gt;)</span>
<span class="line">      ...</span>
<span class="line">      (<span class="name">&lt;varn&gt;</span> &lt;expn&gt;))</span>
<span class="line">  &lt;body&gt;)</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p><strong>1.3.3 Procedures as General Methods</strong></p>
<p>finding roots</p>
<p>finding fixed point</p>
<p><strong>1.3.4 Procedures as Returned Values</strong></p>
<p>return values are themselves procedures</p>
<p>&lt;br/&gt;</p>
<p><strong>Abstractions and first-class procedures</strong></p>
<p>programming languages impose restrictions on the ways in which computational elements can be manipulated</p>
<p>First-class status</p>
<ul>
<li>elements with fewest restrictions</li>
<li>They may be named by variables.</li>
<li>They may be passed as arguments to procedures.</li>
<li>They may be returned as the results of procedures.</li>
<li>They may be included in data structures.</li>
</ul>
<p>Lisp awards <strong>procedures</strong> full first-class status, which poses challenges for efficient implementation, but the resulting gain in expressive power is enormous.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/01/CSAPP/ch-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/01/CSAPP/ch-1/" itemprop="url">[CS:APP-ch1] A Tour of Computer Systems</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-01T20:52:51+08:00">
                2018-01-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSAPP/" itemprop="url" rel="index">
                    <span itemprop="name">CSAPP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/01/CSAPP/ch-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/01/CSAPP/ch-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>CS:APP ch-1 A Tour of Computer Sytems</h2>
<p>A computer system consists of hardware and systems software that work together to run application programs.</p>
<p>Tracing the life time of hello program.</p>
<p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  </span></span></span>
<span class="line">  </span>
<span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span></span>
<span class="line"><span class="function"></span>&#123;  </span>
<span class="line">        <span class="built_in">printf</span>(<span class="string">"hello world!\n"</span>);  </span>
<span class="line">  </span>
<span class="line">        <span class="keyword">return</span> <span class="number">0</span>;  </span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure></p>
<p>&lt;br/&gt;</p>
<p>&lt;!-- more --&gt;</p>
<h4>1.1 Information Is Bits + Context</h4>
<p>The hello program begins life as a source program ( a sequence of bits, organized in bytes )</p>
<p>Text files</p>
<ul>
<li>files consist exclusively ASCII characters.</li>
</ul>
<p>Binary files</p>
<ul>
<li>all other files</li>
</ul>
<p>All information in a system is represented as a bunch of <strong>bits</strong>.</p>
<p>The only thing that distinguishes different data objects is the <strong>context</strong> in which we view them.</p>
<p>&lt;br/&gt;</p>
<h4>1.2 Programs Are Translated by Other Programs into Different Forms</h4>
<p>In order to run hello.c on the system, the individual C statements must be translated by other programs into a sequence of low-level machine-language instructions.</p>
<p>These instructions are then packaged in a form called an executable object program and stored as a binary disk file.</p>
<p><img src="http://img.blog.csdn.net/20140423174324171" alt=""></p>
<h4>1.3 It Pays to Understand How Compilation Systems Work</h4>
<p>Reasons why need to understand compilation systems</p>
<ul>
<li>Optimizing program performance</li>
</ul>
<ul>
<li>Understanding link-time error</li>
<li>Avoiding security holes</li>
</ul>
<p>&lt;br/&gt;</p>
<h4>1.4 Processors Read and Interpret Instructions Stored in Memory</h4>
<p>To run the executable object file, type <code>./hello</code>  to an applcation program known as a shell</p>
<p><strong>Hardware Organization of a System</strong></p>
<ul>
<li>Buses: transfer words</li>
<li>I/O Devices: system’s connection to the external world, connected to I/O bus by either a controller or an adapter</li>
<li>Main Memory:  temporary storage device that holds both a program and the data it manipulates while the processor is executing the program</li>
<li>Processor: the engine that inter-prets (or executes ) instructions stored in main memory</li>
</ul>
<p><img src="http://img.blog.csdn.net/20140423180155531" alt=""></p>
<p>Running hello</p>
<ul>
<li>Reading command from keyboard</li>
<li>Load file from disk to memory</li>
<li>Write output string from memory to display</li>
</ul>
<p><img src="http://img.blog.csdn.net/20140423180827984" alt=""></p>
<p><img src="http://img.blog.csdn.net/20140423180854531" alt=""></p>
<h4>1.5 Caches Matter</h4>
<p>The machine instruction in the hello program are originally stored on disk</p>
<p>When loaded, opied to main memory</p>
<p>When processor runs, copied into the processor ( register + caches )</p>
<p>deal with processor-memory gap</p>
<p>&lt;br/&gt;</p>
<h4>1.6 Storage Devices Form a Hierarchy</h4>
<p>storage at one level serves as a cache for the next lower level</p>
<p><img src="http://img.blog.csdn.net/20140423181308515" alt=""></p>
<h4>1.7 The Operating System Manages the Hardware</h4>
<p>OS</p>
<ul>
<li>a layer of software interposed between the application program and the hardware</li>
<li>two primitive purpose: (1)protect hardware (2)provide applications with simple and uniform mechanisms for manipulating hardwares</li>
<li>achieve both goals via <strong>abstractions</strong></li>
</ul>
<p><img src="http://img.blog.csdn.net/20140423181431437" alt=""></p>
<p><img src="http://img.blog.csdn.net/20140423181504203" alt=""></p>
<p>Process</p>
<ul>
<li>The operating system's abstraction for a running program</li>
<li>context switching</li>
</ul>
<p>Thread</p>
<p>VIrtual Memory</p>
<ul>
<li>Each process has the same uniform view of memory ( virtual address space )</li>
</ul>
<p><img src="http://img.blog.csdn.net/20140423181937906" alt=""></p>
<p>Files</p>
<ul>
<li>A sequence of bytes, nothing more and nothing less</li>
<li>Every I/O devices is modeled as a file</li>
</ul>
<p>&lt;br/&gt;</p>
<h4>1.8 Systems Communicate with Other Systems Using Networks</h4>
<p><img src="http://img.blog.csdn.net/20140423182125734" alt=""></p>
<h4>1.9 Important Themes</h4>
<p>Amdahl's law: observation of the effectiveness</p>
<p><strong>Concurrency and Parallelism</strong></p>
<p>concurrency</p>
<ul>
<li>a system with multiple, simultaneous activities</li>
</ul>
<p>parallelism</p>
<ul>
<li>use of concurrency to make a system run faster</li>
</ul>
<p>Parrallelism can be exploited at multiple( three ) levels of abstraction in a computer system. ( hight --&gt; low )</p>
<ol>
<li>Thread-level Concurrency: multicore &amp; hyperthreading</li>
<li>Instruction-level Parallelism: pipeling</li>
<li>Single-Instruction, Multiple-Data ( SIMD ) Parallelism</li>
</ol>
<p><strong>The Importance of Abstractions in Computer Systems</strong></p>
<p>Processor side</p>
<ul>
<li>instruction set architecture provides an abstraction of actual processor</li>
</ul>
<p>Operating System side</p>
<ul>
<li>Files as an abstraction of I/O</li>
<li>Virtual Memory as an abstraction of Program Memory</li>
<li>Processes as an abstraction of a Running Program</li>
<li>Virtual Machine as an abstraction of the Entire Computer</li>
</ul>
<p><img src="http://img.blog.csdn.net/20140423182814015" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/29/CSAPP/ch-9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Aria">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aria">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/29/CSAPP/ch-9/" itemprop="url">[CS:APP-ch9] Virtual Memory</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-29T17:43:51+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSAPP/" itemprop="url" rel="index">
                    <span itemprop="name">CSAPP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/29/CSAPP/ch-9/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/29/CSAPP/ch-9/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>CS:APP ch-9 Virtual Memory</h2>
<p>Virtual Memory</p>
<ul>
<li>modern systems provide an abstraction of main memory</li>
</ul>
<p>three important capabilities</p>
<ol>
<li>It uses main memory efficiently by treating it as a <strong>cache</strong> for an address space stored on disk, keeping only the active areas in main memory, and transferring data back and forth between disk and memory as needed.</li>
<li>It simplifies memory <strong>management</strong> by providing each process with a uniform address space.</li>
<li>It <strong>protects</strong> the address space of each process from corruption by other processes.</li>
</ol>
<p>&lt;!-- more --&gt;
&lt;br/&gt;</p>
<h4>9.1 Physical and Virtual Addressing</h4>
<p>Main memory organized as an array of M contiguous byte-size cells, each byte has a unique <strong>physical address</strong>.</p>
<p>Physical Addressing: use physical address ( PA ) to access memory</p>
<p>Virtual Addressing: use virtual address ( VA ) and translate to physical address</p>
<p>Addressing Translation: converting a virtual address to a physical one</p>
<p><img src="http://img.blog.csdn.net/20140726024101287" alt=""></p>
<h4>9.2 Address Spaces</h4>
<p>Virtual Address Space</p>
<ul>
<li>CPU generates virtual addresses from an address space of $ N = 2^n $ addresses called the virtual address space  {0 , 1, 2 ,...,N − 1}</li>
</ul>
<p>Physical Address Space</p>
<ul>
<li>A system also has a physical address space that corresponds to the M bytes of physical memory in the system {0 , 1, 2 ,...,M − 1}</li>
</ul>
<p>&lt;br/&gt;</p>
<h4>9.3 VM as a Tool for Caching</h4>
<p>A virtual memory is organized as an array of N contiguous byte-sized cells stored on <strong>disk</strong>. Each byte has a unique virtual address that serves as an index into the array.</p>
<p>VM systems partition the virtual memory into fixed-size blocks call <strong>Virtual Pages ( VP )</strong> as transfer units between <strong>disk</strong> and <strong>main memory</strong>.</p>
<p>Three sets of VP: Unallocated, Cached, Uncached</p>
<p><img src="http://img.blog.csdn.net/20140726024435296" alt=""></p>
<p>DRAM cache organization</p>
<ol>
<li>large virtual pages ( cache block )( 4 KB to 2 MB )</li>
<li>fully associative</li>
<li>sophisticated replacement algorithms</li>
<li>use write-back</li>
</ol>
<p><strong>Page Tables</strong></p>
<p>A data structure stored in physical memory that maps virtual pages to physical pages.</p>
<p><img src="http://img.blog.csdn.net/20140727083649381" alt=""></p>
<p>Page Hit</p>
<p>Check valid bit, uses the physical memory address in the PTE (which points to the start of the cached page in PP 1) to construct the physical address of the word.</p>
<p><img src="http://img.blog.csdn.net/20140727084524775" alt=""></p>
<p>Page Faults</p>
<p>The page fault exception invokes a <strong>page fault exception handler</strong> in the kernel</p>
<ol>
<li>selects a victim page, in this case VP 4 stored in PP 3.</li>
<li>modifies the page table entry for VP 4 to reflect the fact that VP 4 is no longer cached in main memory.</li>
<li>copies VP 3 from disk to PP 3 in memory, updates PTE 3, and then returns.</li>
<li>restarts the faulting instruction and page hit</li>
<li>The strategy of waiting until the last moment to swap in a page, when a miss occurs, is known as <strong>demand paging</strong></li>
</ol>
<p><img src="http://img.blog.csdn.net/20140727085405051" alt=""></p>
<h4>9.4 VM as a Tool for Memory Management</h4>
<p>Operating systems provide a <strong>separate page table</strong>, and thus a separate virtual address space, for each <strong>process</strong>.</p>
<ol>
<li>
<p>Linking: Allow each <strong>process</strong> to use the same basic format for its memory image ( code segment always start at 0x400000 )</p>
</li>
<li>
<p>Loading: (1) Allocate Virtual Pages (2) Mark as invalid ( not cached ) (3) Point table entries to the location of in object file (4) Data are paged in th first time referenced</p>
</li>
<li>
<p>Sharing: Multiple processes share a single copy of some code</p>
</li>
<li>
<p>Memory Allocation</p>
<p><img src="http://img.blog.csdn.net/20140727090642531" alt=""></p>
<p>​</p>
<h4></h4>
<p>​</p>
</li>
</ol>
<h4>9.5 VM as a Tool for Memory Protection</h4>
<p>three permission bits to each PTE</p>
<ul>
<li>SUP must run in kernel mode</li>
<li>READ / WRITE</li>
</ul>
<p>&lt;br/&gt;</p>
<h4>9.6 Address Translation</h4>
<p>a mapping between an N-element virtual address space and M-element physical address space</p>
<p><img src="http://img.blog.csdn.net/20140727120229642" alt=""></p>
<p>Steps that the CPU hardware performs when there is a page hit / fault</p>
<p><img src="http://img.blog.csdn.net/20140727120529090" alt=""></p>
<p>Speeding up Address Translation with a TLB</p>
<ul>
<li>a small cache of PTEs in the MMU called a translation look aside buffer (TLB)</li>
</ul>
<p>Multi-Level Page Tables</p>
<p><img src="http://img.blog.csdn.net/20140727132255390" alt=""></p>
<p><img src="http://img.blog.csdn.net/20140727133211948" alt=""></p>
<p>つ....つづく！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Aria" />
            
              <p class="site-author-name" itemprop="name">Aria</p>
              <p class="site-description motion-element" itemprop="description">This guy is so lazy that he left nothing</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://goushi.me/" title="ダーリンのblog" target="_blank">ダーリンのblog</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>

    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Aria</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

   

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://aria-3.disqus.com/count.js" async></script>
    

    

  

















  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>


